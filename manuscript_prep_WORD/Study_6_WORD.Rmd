---
title             : "Study 6"
shorttitle        : "Cognitive Load and Moral Dumbfounding"
author:
  - name          : "Blinded"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Blinded"
    email         : "Blinded"
  - name          : "Blinded"
    affiliation   : "2"
  - name          : "Blinded"
    affiliation   : "1"
  - name          : "Blinded"
    affiliation   : "1"
affiliation:
  - id            : "1"
    institution   : "Blinded"
  - id            : "2"
    institution   : "Blinded"
author_note: >
  All procedures performed in studies involving human participants were approved by institutional research ethics committee and conducted in accordance with the Code of Professional Ethics of the Psychological Society of Ireland, and with the 1964 Helsinki declaration and its later amendments or comparable ethical standards. Informed consent was obtained from all individual participants included in the study. The authors declare that there are no potential conflicts of interest with respect to the research, authorship, and/or publication of this article. All authors consented to the submission of this manuscript.
abstract: >
  Six studies etc.
keywords          : "keywords"
wordcount         : "TBC"
bibliography: "../resources/bib/My Library.bib"
csl: "../resources/bib/apa6.csl"
figsintext        : no
floatsintext      : no
figurelist        : yes
tablelist         : yes
footnotelist      : no
lineno            : no
toc               : false
lang              : "en-US"
documentclass     : "apa7"
output:
  papaja::apa6_word
header-includes:
- \raggedbottom
editor_options: 
  chunk_output_type: console
---



```{r S6setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, include = FALSE)
# knitr::opts_chunk$set(eval = TRUE, echo = TRUE)
#knitr::opts_chunk$set(include = FALSE)
```



```{r S6load_libraries_cogload}
rm(list = ls())
library(citr)
#install.packages("sjstats")
library(plyr)
library(foreign)
library(car)
library(desnum)
library(ggplot2)
library(extrafont)
#devtools::install_github("crsh/papaja")
library(papaja)
#library("dplyr")
library("afex")
library("tibble")
library(scales)
#install.packages("metap")
library(metap)
library(pwr)
library(lsr)
#install.packages("sjstats")
library(sjstats)
library(DescTools)
#inatall.packages("ggstatsplot")
#library(ggstatsplot)
library(VGAM)
library(nnet)
library(mlogit)
library(reshape2)
#install.packages("powerMediation")
library("powerMediation")


#source("load_all_data.R")

#devtools::install_github("benmarwick/wordcountaddin")
#library(wordcountaddin)
#wordcountaddin::text_stats("cogload_1to5_25Sept19.Rmd")
getwd()
```

# Study 6 - Pre-registered Replication
In response to the mixed findings in Studies 1-5, the aim of Study 6 was to test if cognitive load influences participants' ability to justify their judgments in high-powered, large sample study. Study 6 was pre-registered (see [https://aspredicted.org/XZP_UHW](https://aspredicted.org/XZP_UHW)).


```{r S6loaddatasetStudy6}
#source("~/Dropbox/College/research/Research_general/cog_load/moral_dumbfounding_and_cognitive_load/read_and_sort_raw_data.R")
#source("~/Dropbox/College/research/Research_general/cog_load/moral_dumbfounding_and_cognitive_load/load_study6_data.R")
rm(list = ls())

load("../loaded_data/six.RData")
study_6$age <- as.numeric(study_6$age)
df3 <- study_6

# haven::write_sav(study_6, "study_6.sav")

#df3$InCS
# df3 <- df3[which(is.na(df3$InCS)==FALSE),]
# df3 <- df3[which(df3$InCS!="null"),]

#df3$InCS <- df3$CS

```

## Study 6: Method
### Study 6: Participants and design
Study 6 was a between subjects design.  The dependent variable was rates of providing reasons/dumbfounding (measured using to the critical slide as in previous studies).  The primary independent variable was cognitive load with two levels: present and absent. To manipulate cognitive load, a stream of numbers scrolled across the screen above the question text, and participants were required to pay attention to how many times they saw a given number. Scenario served as a secondary independent variable, we used four scenarios: *Julie and Mark (Incest)*, *Jennifer (Cannibal)*, *Trolley*, *Heinz*.

A total sample of `r length(df3$InCS)` participants (`r sum(df3$gender=="0",na.rm=T)` female, `r sum(df3$gender=="1", na.rm=T)` male, `r sum(df3$gender=="2", na.rm=T)` non-binary, `r sum(df3$gender=="3", na.rm=T)` other, `r sum(df3$gender=="4", na.rm=T)` prefer not to say; *M*~age~ = `r round(mean(df3$age, na.rm=T),digits=2)`, min = `r min(df3$age, na.rm=T)`, max = `r max(df3$age, na.rm=T)`, *SD* = `r round(sd(df3$age, na.rm=T),digits=2)`) started the survey.  Participants in this sample were recruited from Prolific (*n~UK~* = `r sum(df3$country=="UK")`, *n~US~* = `r sum(df3$country=="US")`).




```{r}

x <- study_6
x$attention_check1
x$attention_check2
sum(x$attention_check1!=8)#/4

x$attention_check2!=2|x$attention_check2!=5

sum((x$attention_check2==1|x$attention_check2==4)==FALSE)#/4

x$attention_check1[which((x$attention_check2==1|x$attention_check2==4)==FALSE)]

x$attention_check1[which((x$attention_check2==1|x$attention_check2==4)==FALSE&x$attention_check1!=8)]


att1 <- sum(x$attention_check1!=8,na.rm = T)#/4
att2 <- sum((x$attention_check2==1|x$attention_check2==8)==FALSE,na.rm = T)#/4
att_both <- sum((x$attention_check2==1|x$attention_check2==4)==FALSE&x$attention_check1!=8,na.rm = T)#/4


```


```{r}
x <- study_6

x <- x[which(((x$attention_check2==1|x$attention_check2==5)==FALSE&x$attention_check1!=8)==FALSE),]


table(x$condition)
table(x$InJu1)
sum(is.na(x$InJu1))
table(x$InJu2)
sum(is.na(x$InJu2))
table(x$condition)

x <- x[which(x$InJu1!="null"),]
x <- x[which(is.na(x$InJu1)==FALSE),]
x <- x[which(x$InJu2!="null"),]
x <- x[which(is.na(x$InJu2)==FALSE),]
x <- x[which(is.na(x$InCS)==FALSE),]
x <- x[which(x$InCS!="null"),]



table(x$InJu1)
sum(is.na(x$InJu1))
table(x$InJu2)
sum(is.na(x$InJu2))
table(x$InCS)
sum(is.na(x$InCS))
# 
# x$InJu1 <- as.numeric(x$InJu1)
# x$InJu2 <- as.numeric(x$InJu2)

study_6_clean <- x
df3 <- study_6_clean


df4 <- df3[which(df3$condition=="cog_load"),]
df5 <- df3[which(df3$condition=="control"),]

(length(study_6$gender)-length(study_6_clean$gender))-att_both
length(study_6_clean$gender)
```

Participants who failed both manipulation checks (*n* = `r att_both`) or who had missing data for the measures of interest were removed, leaving a total sample of `r length(df3$InCS)` participants (`r sum(df3$gender=="0",na.rm=T)` female, `r sum(df3$gender=="1", na.rm=T)` male, `r sum(df3$gender=="2", na.rm=T)` non-binary, `r sum(df3$gender=="3", na.rm=T)` other, `r sum(df3$gender=="4", na.rm=T)` prefer not to say; *M*~age~ = `r round(mean(df3$age, na.rm=T),digits=2)`, min = `r min(df3$age, na.rm=T)`, max = `r max(df3$age, na.rm=T)`, *SD* = `r round(sd(df3$age, na.rm=T),digits=2)`), *n~UK~* = `r sum(df3$country=="UK")`, *n~US~* = `r sum(df3$country=="US")`.




### Study 6: Procedure and materials
Data were collected using an online questionnaire developed with jsPsych and distributed with cognition.run. Participants were presented with one of four moral scenarios (*Julie and Mark*, *Jennifer*, *Trolley*, *Heinz*, see supplementary materials for full wording), previously used in studies of moral dumbfounding [McHugh et al., -@mchugh_searching_2017a]. The sequence of responses was similar to previous studies, but with content of questions and counter arguments updated to match the relevant scenarios (see supplementary materials).

To manipulate cognitive load manipulation in Study 6, drawing on @greene_cognitive_2008 we included a video stream of numbers scrolling above the question text. The video was wide enough to display 3 numbers at a time, and the numbers scrolled past at a speed of 2 numbers per second. Participants were asked to attend to and report (on a subsequent page) how many times a particular number appeared in the stream, while answering the target question. Following an initial training task, the video was presented while participants made their initial judgments, while they responded to the critical slide, and while they were providing their revised judgments.

Two attention check tasks were included for all participants, these included a brief paragraph of text where instructions for the correct response were embedded within the text. The wording of the text was misleading such that if participants skimmed or only read some of the text they would likely provide an incorrect response. In order to keep the survey short to facilitate the recruiting of a large sample, we did not record Need for Cognition in Study 6.

Participants clicked on the survey link and were randomly assigned to either the experimental condition or the control condition, within which they were randomly presented with one of the four scenarios. The study was complete within 5 minutes.


```{r S6checkingchanges6a, include=FALSE}

length(df3$gender)
table(df3$condition)
table(df3$country)
table(df3$condition,df3$scenario)


```






```{r S6change in judgement}

# create variables for reporting t.tests
#t <- t.test(df3$InJu1,df3$InJu2, paired = TRUE)

#chisquare test function

custom_chi <- function(x,y){
  a <- length(x)
  b <- length(y)
  c <- rep(1, a)
  d <- rep(2, b)
  e <- c(c,d)
  f <- c(x, y)
  
  g <- data.frame(e,f)
  h <- table(g$e,g$f)
  suppressWarnings(chisq.test(h))
}

c <- suppressWarnings(custom_chi(df3$InJu1,df3$InJu2))

changed_num <- function(x, judgement_1, judgement_2){
  b <- b <- x[which(x$Ju1_bin==judgement_1 & x$Ju2_bin==judgement_2),]
  length(b$Ju1_bin)
  
}

tot_changed_num <- function(x, query){
  
  c <- cbind.data.frame(x$Ju1_bin[which(x$Ju1_bin!=x$Ju2_bin)],x$Ju2_bin[which(x$Ju1_bin!=x$Ju2_bin)])
  colnames(c) <- c("initial_judgement","revised_judgement")
  
  c
  if(query == "table") print(c)
  if(query == "total") print(length(c$initial_judgement))}



tot_changed_table <- function(x){
  
  c <- cbind.data.frame(x$Ju1_bin[which(x$Ju1_bin!=x$Ju2_bin)],x$Ju2_bin[which(x$Ju1_bin!=x$Ju2_bin)])
  colnames(c) <- c("Initial Judgment","Revised Judgment")
  
  c
  }


change_table <- tot_changed_table(df3)
change_table <- table(change_table)
change_table <- as.data.frame(change_table)
change_table <- change_table[which(change_table$Freq!=0),]
change_table <- change_table[order(change_table$Initial.Judgment, change_table$Revised.Judgment), ]
change_table <- `rownames<-`(change_table,NULL)
colnames(change_table) <- c("Initial Judgment","Revised Judgment", "Total Changed")
change_table

```



```{r S6change,results = 'asis', include=FALSE}


apa_table(
   change_table
   , align = c("l","l", "c")
   , caption = "Study 6 – Changes in Jugment (full sample)"
   #, added_stub_head = "Response to critical slide"
   #, col_spanners = makespanners()
   #, note = "* = sig. at \\emph{p} < .05; ** = sig. at \\emph{p} < .001"
   , escape = FALSE
   
)

```


```{r S6checkingchanges6, include=FALSE}
chisq.test(table(df3$InCS,df3$condition),correct = TRUE)
df3$InJu1 <- as.numeric(as.character(df3$InJu1))
df3$InJu2 <- as.numeric(as.character(df3$InJu2))

t_j1 <- t.test(df3$InJu1 ~ df3$condition)
d_j1 <- cohensD(df3$InJu1 ~ df3$condition)

t_paragraph(df3$InJu1, df3$condition, "initial judgement")
#t_paragraph(one$InJu1, one$condition, "initial judgement")
#t_paragraph(two$InJu1, two$condition, "initial judgement")
#t_paragraph(three$InJu1, three$condition, "initial judgement")


t_j2 <- t.test(df3$InJu2 ~ df3$condition)
d_j2 <- cohensD(df3$InJu2 ~ df3$condition)

t_paragraph(df3$InJu2, df3$condition, "revised judgement")
#t_paragraph(one$InJu1, one$condition, "initial judgement")
#t_paragraph(two$InJu1, two$condition, "initial judgement")
#t_paragraph(three$InJu1, three$condition, "initial judgement")

t_paired_paragraph(df3$InJu1,df3$InJu2, "judgment")
t_j3 <- t.test(df3$InJu1,df3$InJu2,paired = TRUE)
d_j3 <- cohensD(df3$InJu1,df3$InJu2, method = "paired")

numbers2words_cap2(length(df3$Ju1_bin[df3$Ju1_bin=="wrong"]))
numbers2words_cap1(length(df3$InCS[which(df3$InCS=="It's wrong but I can't think of a reason.")]))
numbers2words_cap1(length(df3$InCS[which(df3$InCS=="It's wrong and I can provide a valid reason.")]))
numbers2words(length(df3$InCS[which(df3$InCS=="There is nothing wrong.")]))
```

## Study 6: Results
One thousand three hundred sixty-five participants (`r round(((length(df3$Ju1_bin[df3$Ju1_bin=="wrong"])/length(df3$Ju1_bin))*100), digits=2)`%) rated the behavior described as wrong initially, and `r numbers2words(length(df3$Ju2_bin[df3$Ju2_bin=="wrong"]))` participants (`r round(((length(df3$Ju2_bin[df3$Ju2_bin=="wrong"])/length(df3$Ju2_bin))*100), digits=2)`%) rated the behavior as wrong at the end of the task. Initial ratings (*M* = `r round(mean(df3$InJu1), digits = 2)`, *SD* = `r round(sd(df3$InJu1), digits = 2)`) were significantly more severe than revised ratings (*M* = `r round(mean(df3$InJu2), digits = 2)`, *SD* = `r round(sd(df3$InJu2), digits = 2)`), *t*(`r t_j3$parameter`) = `r t_j3$statistic`, *p* `r paste(p_report(t_j3$p.value))`; *d* = `r round(d_j3, digits=2)`. Inspection of the binned judgments revealed that `r numbers2words(tot_changed_num(df3, "total"))` (`r round((tot_changed_num(df3, "total"))/length(df3$gender)*100, digits = 2)`%) participants changed the valence of their judgments, breakdown of the changes in judgments is in Table XX (full sample) and Table XX (by scenario) in the supplementary materials.

```{r}
# x$InJu1 <- as.numeric(x$InJu1)
# x$InJu2 <- as.numeric(x$InJu2)

TukeyHSD(aov(InJu1 ~ condition+scenario, data = df3))

aov1 <- summary(aov(InJu1 ~ condition*scenario, data = df3))
TukeyHSD(aov(InJu1 ~ condition*scenario, data = df3))
TukeyHSD(aov(InJu1 ~ condition+scenario, data = df3))
aov1
aov1[[1]][["Pr(>F)"]][1]
c(aov1[[1]][["Df"]], " ", ",")[c(1, 6, 5, 4)] # condition
c(aov1[[1]][["Df"]], " ", ",")[c(2, 6, 5, 4)] # scenario
c(aov1[[1]][["Df"]], " ", ",")[c(3, 6, 5, 4)] # interaction
aov1[[1]][["F value"]][1]
aov1[[1]][["F value"]][1]


eta_condition1 <- (aov1[[1]][["Sum Sq"]][1])/((aov1[[1]][["Sum Sq"]][1])+(aov1[[1]][["Sum Sq"]][4]))

eta_scenario1 <- (aov1[[1]][["Sum Sq"]][2])/((aov1[[1]][["Sum Sq"]][2])+(aov1[[1]][["Sum Sq"]][4]))

eta_interaction1 <- (aov1[[1]][["Sum Sq"]][3])/((aov1[[1]][["Sum Sq"]][3])+(aov1[[1]][["Sum Sq"]][4]))


c(aov1[[1]][["Df"]], " ", ",")[c(3, 6, 5, 4)]

round(mean(x$InJu1[which(x$condition=="cog_load")]), digits=2)

tapply(x$InJu1,x$scenario,descriptives)

#aov2 <- summary(aov(as.numeric(InJu2) ~ condition*scenario, data = df3))
```

A 2 $\times$ 2 factorial ANOVA revealed significant differences in initial judgments depending on both condition *F*(`r c(aov1[[1]][["Df"]], " ", ",")[c(1, 6, 5, 4)]`) = `r round(aov1[[1]][["F value"]][1],digits=2)`, *p* `r paste(p_report(aov1[[1]][["Pr(>F)"]][1]))`, partial $\eta$^2^ `r paste(p_report(eta_condition1))`, and scenario *F*(`r c(aov1[[1]][["Df"]], " ", ",")[c(2, 6, 5, 4)]`) = `r round(aov1[[1]][["F value"]][2],digits=2)`, *p* `r paste(p_report(aov1[[1]][["Pr(>F)"]][2]))`, partial $\eta$^2^ `r paste(p_report(eta_scenario1))`. Participants under cognitive load were significantly (*p* < .001) less harsh in their judgments (*M* = `r round(mean(x$InJu1[which(x$condition=="cog_load")]), digits=2)`, *SD* = `r round(sd(x$InJu1[which(x$condition=="cog_load")]), digits=2)`) than those in the control condition (*M* = `r round(mean(x$InJu1[which(x$condition=="control")]), digits=2)`, *SD* = `r round(sd(x$InJu1[which(x$condition=="control")]), digits=2)`). Participants rated *Jennifer* as the most wrong (*M* = `r round(mean(x$InJu1[which(x$scenario=="Jennifer")]), digits=2)`, *SD* = `r round(sd(x$InJu1[which(x$scenario=="Jennifer")]), digits=2)`), followed by *Julie and Mark* (*M* = `r round(mean(x$InJu1[which(x$scenario=="Incest")]), digits=2)`, *SD* = `r round(sd(x$InJu1[which(x$scenario=="Incest")]), digits=2)`, *p* < .001), then *Heinz* (*M* = `r round(mean(x$InJu1[which(x$scenario=="Heinz")]), digits=2)`, *SD* = `r round(sd(x$InJu1[which(x$scenario=="Heinz")]), digits=2)`, *p* < .001), with *Trolley* receiving the least severe judgment (*M* = `r round(mean(x$InJu1[which(x$scenario=="Trolley")]), digits=2)`, *SD* = `r round(sd(x$InJu1[which(x$scenario=="Trolley")]), digits=2)`, *p* < .001). There was no significant condition $\times$ scenario interaction *F*(`r c(aov1[[1]][["Df"]], " ", ",")[c(3, 6, 5, 4)]`) = `r round(aov1[[1]][["F value"]][3],digits=2)`, *p* `r paste(p_report(aov1[[1]][["Pr(>F)"]][3]))`, partial $\eta$^2^ `r paste(p_report(eta_interaction1))`.


```{r}
# x$InJu1 <- as.numeric(x$InJu1)
# x$InJu2 <- as.numeric(x$InJu2)

TukeyHSD(aov(InJu1 ~ condition+scenario, data = df3))

aov1 <- summary(aov(InJu2 ~ condition*scenario, data = df3))
aov1
TukeyHSD(aov(InJu2 ~ condition*scenario, data = df3))
TukeyHSD(aov(InJu2 ~ condition+scenario, data = df3))
aov1
aov1[[1]][["Pr(>F)"]][1]
c(aov1[[1]][["Df"]], " ", ",")[c(1, 6, 5, 4)] # condition
c(aov1[[1]][["Df"]], " ", ",")[c(2, 6, 5, 4)] # scenario
c(aov1[[1]][["Df"]], " ", ",")[c(3, 6, 5, 4)] # interaction
aov1[[1]][["F value"]][1]
aov1[[1]][["F value"]][1]


eta_condition1 <- (aov1[[1]][["Sum Sq"]][1])/((aov1[[1]][["Sum Sq"]][1])+(aov1[[1]][["Sum Sq"]][4]))

eta_scenario1 <- (aov1[[1]][["Sum Sq"]][2])/((aov1[[1]][["Sum Sq"]][2])+(aov1[[1]][["Sum Sq"]][4]))

eta_interaction1 <- (aov1[[1]][["Sum Sq"]][3])/((aov1[[1]][["Sum Sq"]][3])+(aov1[[1]][["Sum Sq"]][4]))


c(aov1[[1]][["Df"]], " ", ",")[c(3, 6, 5, 4)]

round(mean(x$InJu1[which(x$condition=="cog_load")]), digits=2)

tapply(x$InJu2,x$scenario,descriptives)

#aov2 <- summary(aov(as.numeric(InJu2) ~ condition*scenario, data = df3))
```

A 2 $\times$ 2 factorial ANOVA revealed significant differences in revised judgments depending on both condition *F*(`r c(aov1[[1]][["Df"]], " ", ",")[c(1, 6, 5, 4)]`) = `r round(aov1[[1]][["F value"]][1],digits=2)`, *p* `r paste(p_report(aov1[[1]][["Pr(>F)"]][1]))`, partial $\eta$^2^ `r paste(p_report(eta_condition1))`, and scenario *F*(`r c(aov1[[1]][["Df"]], " ", ",")[c(2, 6, 5, 4)]`) = `r round(aov1[[1]][["F value"]][2],digits=2)`, *p* `r paste(p_report(aov1[[1]][["Pr(>F)"]][2]))`, partial $\eta$^2^ `r paste(p_report(eta_scenario1))`. Participants under cognitive load were significantly (*p* < .001) less harsh in their judgments (*M* = `r round(mean(x$InJu2[which(x$condition=="cog_load")]), digits=2)`, *SD* = `r round(sd(x$InJu2[which(x$condition=="cog_load")]), digits=2)`) than those in the control condition (*M* = `r round(mean(x$InJu2[which(x$condition=="control")]), digits=2)`, *SD* = `r round(sd(x$InJu2[which(x$condition=="control")]), digits=2)`). Participants rated *Jennifer* as the most wrong (*M* = `r round(mean(x$InJu2[which(x$scenario=="Jennifer")]), digits=2)`, *SD* = `r round(sd(x$InJu2[which(x$scenario=="Jennifer")]), digits=2)`), followed by *Julie and Mark* (*M* = `r round(mean(x$InJu2[which(x$scenario=="Incest")]), digits=2)`, *SD* = `r round(sd(x$InJu2[which(x$scenario=="Incest")]), digits=2)`, *p* < .001), then *Heinz* (*M* = `r round(mean(x$InJu2[which(x$scenario=="Heinz")]), digits=2)`, *SD* = `r round(sd(x$InJu2[which(x$scenario=="Heinz")]), digits=2)`, *p* = .003), with *Trolley* receiving the least severe judgment (*M* = `r round(mean(x$InJu2[which(x$scenario=="Trolley")]), digits=2)`, *SD* = `r round(sd(x$InJu2[which(x$scenario=="Trolley")]), digits=2)`, *p* < .001). There was no significant condition $\times$ scenario interaction *F*(`r c(aov1[[1]][["Df"]], " ", ",")[c(3, 6, 5, 4)]`) = `r round(aov1[[1]][["F value"]][3],digits=2)`, *p* `r paste(p_report(aov1[[1]][["Pr(>F)"]][3]))`, partial $\eta$^2^ `r paste(p_report(eta_interaction1))`.

Dumbfounding was recorded using the critical slides, participants who selected the admission of not having reasons on the critical slide were identified as dumbfounded.  Four hundred and seventeen participants (`r round((length(df3$InCS[which(df3$InCS=="It's wrong but I can't think of a reason.")])/(length(df3$InCS)))*100, digits=2)`%) selected "It's wrong but I can't think of a reason". One thousand and thirty-two participants (`r round((length(df3$InCS[which(df3$InCS=="It's wrong and I can provide a valid reason.")])/(length(df3$InCS)))*100,digits=2)`%) selected “It's wrong and I can provide a valid reason”; and two hundred and thirty-seven participants (`r round((length(df3$InCS[which(df3$InCS=="There is nothing wrong.")])/(length(df3$InCS)))*100,digits=2)`%) selected “There is nothing wrong”.

```{r}

c <- chisq.test(table(df3$InCS,df3$condition))
w <- sqrt(c[]$statistic/length(df3$gender))
pw <- pwr.chisq.test(w=w,N=length(df3$InCS),df=(3-1),sig.level = .05)

```

A chi-squared test for independence revealed a significant association between experimental condition and response to the critical slide, $\chi$^2^(`r c$parameter`, *N* = `r length(df3$Ju1_bin)`) = `r round(c$statistic, digits=3)`, *p* `r paste(p_report(c$p.value))`, *V* = `r w`, the observed power was `r paste(round(pw$power,digits=3))`.  As predicted, under cognitive load fewer participants (`r sum(df4$InCS=="It's wrong and I can provide a valid reason.",na.rm=T)`; `r sum(df4$InCS=="It's wrong and I can provide a valid reason.",na.rm=T)/length(df4$gender)*100`%) provided reasons than in the control condition (`r sum(df5$InCS=="It's wrong and I can provide a valid reason.",na.rm=T)`; `r sum(df5$InCS=="It's wrong and I can provide a valid reason.",na.rm=T)/length(df5$gender)*100`%), and more participants (`r sum(df4$InCS=="It's wrong but I can't think of a reason.",na.rm=T)`; `r sum(df4$InCS=="It's wrong but I can't think of a reason.",na.rm=T)/length(df4$gender)*100`%) selected "It's wrong but I can't think of a reason." than in the control group (`r sum(df5$InCS=="It's wrong but I can't think of a reason.",na.rm=T)`; `r sum(df5$InCS=="It's wrong but I can't think of a reason.",na.rm=T)/length(df5$gender)*100`%).  The responses to the critical slide for the experimental group (*N* = `r sum(df3$condition=="cog_load")`) and the control group (*N* = `r sum(df3$condition=="control")`) are displayed in Figure\ \@ref(fig:S6ch5S6fig1criticalconditionb).  The observed counts, expected counts and standardised residuals are displayed in Table\ \@ref(tab:S6tab1dumb).  


```{r}

test <- as.data.frame.matrix((table(df3$InCS,df3$condition)))
`rownames<-`(test, c("nothing wrong","no reason","reasons"))
test <- as.matrix((test))
test1 <- cbind(test[,1],test[,2])
test2 <- `colnames<-`(test1, c("cognitive load","control"))

tb_count_perc <- function(x){
  tc <- table(x$InCS,x$condition)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$condition=="cog_load")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$condition=="control")*100),"%"))
  }
  
tb_count_perc_eng <- function(x){
  tc <- table(x$InCS,x$engaged)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$engaged=="engaged")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$engaged=="not engaged")*100),"%"))
  }
  
test <- tb_count_perc(df3)
test <- as.data.frame(test)
colnames(test) <- c("N","\\%","N","\\%")
  
makespanners <- function(){
  cog_load <- c(2,3)
  control <- c(4,5)
  spans <- list(cog_load,control)
  names(spans) <- c("Cognitive Load","Control")
  spans
}

#test <- tb_count_perc(df3)
#tb_count_perc(df3a)



```


```{r S6tab1dumb1all,results = 'asis', include=FALSE}


apa_table(
   test
   , align = c("l", "c", "c", "c", "c")
   , caption = "Study 6 – Response to the critical slide depending on cognitive load (full sample)"
   #, added_stub_head = "Response to critical slide"
   , col_spanners = makespanners()
   #, note = "* = sig. at \\emph{p} < .05; ** = sig. at \\emph{p} < .001"
   , escape = FALSE
   
)

```

\newpage


```{r}


y <- table(df3$condition,df3$InCS)
y <- as.data.frame(y)
colnames(y) <- c("condition","InCS","Freq")

z <- as.data.frame(table(df3$condition,df3$InCS)/length(df3$gender)*2)
perc <- z$Freq
test <- cbind(y,perc)
test$condition
test


#y <- table(df3$condition,df3$Dumb_incl_string)
#y <- as.data.frame(y)
#colnames(y) <- c("condition","InCS","Freq")

# z <- as.data.frame(table(df3$condition,df3$Dumb_incl_string)/length(df3$gender)*2)
# perc <- z$Freq
# test <- cbind(y,perc)
# test$condition
# test


ab_graph <- function(){
  a <- df3[which(df3$condition==levels(as.factor(df3$condition))[1]),]
  b <- df3[which(df3$condition==levels(as.factor(df3$condition))[2]),]
  a#levels(as.factor(df3$condition))[1]
  
  ay <- as.data.frame(table(a$InCS,as.character(a$condition)))
  by <- as.data.frame(table(b$InCS,as.character(b$condition)))
  
  aperc <- ay$Freq/length(a$gender)
  ay <- cbind(ay,aperc)
  colnames(ay) <- c("InCS","condition","Freq","perc")
  
  bperc <- by$Freq/length(b$gender)
  by <- cbind(by,bperc)
  colnames(by) <- c("InCS","condition","Freq","perc")
  
  c <- rbind(ay,by)
  
  c
}

test <- ab_graph()



rm(y)
```


```{r S6ch5S6fig1criticalconditionb, fig.cap="Study 6: Responses to critical slide depending on cognitive load", include=TRUE}

#g <- 
ggplot(test, aes(x=reorder(InCS), y=perc, fill=factor(condition,labels=c("Cognitive load","Control")))) +
  scale_y_continuous(limits = c(-.03,1),
                     labels = percent_format()
  )+ 
  geom_col(position = "dodge",
           color="black",
           size=.2
  )+
  geom_text(#family = "Times",
            size=4.2,
            aes( label = scales::percent(perc, accuracy = 1),
                 y= perc ),
            stat= "identity",
            vjust = -.5,
            position = position_dodge(.9),
            fontface='plain'
            )+
  geom_text(#family = "Times", 
            size=4.2,
            aes(label = format(Freq),
                y= -3*(..count../100)/(..count..)),
            stat= "count",
            position = position_dodge(0.9),
            #vjust = -.05,
            fontface='plain'
            ) +
  xlab("Response to Critical Slide") +
  ylab("Percentage of participants selecting each response")+
  scale_x_discrete(labels=c("Reasons", "Dumbfounded","Nothing Wrong")) +
  scale_fill_grey(start = .5, end = .8) +
  labs(fill="Condition") +
  #theme_apa() +
  theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(size = .2),
        strip.background  = element_blank(),
        panel.grid = element_blank(),
        plot.title=element_text(#family="Times",
                                size=12
                                ),
        legend.text=element_text(#family="Times",
                                 size=8
                                 ),
        legend.title=element_text(#family="Times",
                                    size=10
                                 ),
        axis.text=element_text(#family="Times",
                                 colour = "black",
                                 size=8
                                 ),
        axis.ticks.x = element_blank(),
        axis.title=element_text(#family="Times",
                                  size=12
                                  ),
        strip.text=element_text(#family = "Times",
                                  size = 12
                                  ),
        #strip.background = element_rect(fill = "white"),
        legend.position="right")





```


```{r S6preptableS6}
c <- chisq.test(table(df3$InCS,df3$condition))
rownames(rbind(c$observed,c$expected,c$stdres))



ps <- function(y){
  if(as.numeric(sqrt( y*y) ) >3.3) print(paste0(y,"**"), quote = FALSE)
  else if(as.numeric(sqrt( y*y) ) >1.96) print(paste0(y,"*"), quote = FALSE)
  else print(y)}


x <- c$stdres
x <- round(x, digits = 2)

lapply(x, ps)

#c$stdres <- round(c$stdres,digits=3)
#c$stdres <- ps(c$stdres)

ps(x[1])
ps(x[2])
ps(x[3])

x <- `colnames<-`(
  cbind.data.frame(c(ps(x[1]),ps(x[2]),ps(x[3])),
                   c(ps(x[4]),ps(x[5]),ps(x[6]))),
  c("cog_load","control")
)

rownames(x) <- row.names(c$observed)  

y <- rbind(round(c$observed), round(c$expected, digits = 2))

c(c$stdres[1])


res <- cbind(c("Observed count","","","Expected count","","","Standardised residuals","",""),
      c("Reasons","Dumbfounded","Nothing Wrong",
        "Reasons","Dumbfounded","Nothing Wrong",
        "Reasons","Dumbfounded","Nothing Wrong"),
      rbind(y,x)
      
      )

row.names(res) <- NULL
colnames(res) <- c("","","Cognitive Load","Control")




```


```{r S6tab1dumb,results = 'asis', include=TRUE}


apa_table(
   res
   , align = c("l", "l", "c", "c", "c")
   , caption = "Study 6 – Observed counts, expected counts, and standardised residuals for each response to the critical slide depending on cognitive load (full sample)"
   #, added_stub_head = "Response to critical slide"
   #, col_spanners = makespanners()
   , note = "* = sig. at \\emph{p} < .05; ** = sig. at \\emph{p} < .001"
   , escape = FALSE
   
)

```


```{r}
## breakdown by scenario
df3 <- study_6_clean
df3 <- df3[which(df3$scenario=="Incest"),]
c1 <- chisq.test(table(df3$InCS,df3$condition))
w1 <- sqrt(c[]$statistic/length(df3$gender))
pw1 <- pwr.chisq.test(w=w,N=length(df3$InCS),df=(3-1),sig.level = .05)


df3 <- study_6_clean
df3 <- df3[which(df3$scenario=="Jennifer"),]
c2 <- chisq.test(table(df3$InCS,df3$condition))
w2 <- sqrt(c[]$statistic/length(df3$gender))
pw2 <- pwr.chisq.test(w=w,N=length(df3$InCS),df=(3-1),sig.level = .05)


df3 <- study_6_clean
df3 <- df3[which(df3$scenario=="Trolley"),]
c3 <- chisq.test(table(df3$InCS,df3$condition))
w3 <- sqrt(c[]$statistic/length(df3$gender))
pw3 <- pwr.chisq.test(w=w,N=length(df3$InCS),df=(3-1),sig.level = .05)

df3 <- study_6_clean
df3 <- df3[which(df3$scenario=="Heinz"),]
c4 <- chisq.test(table(df3$InCS,df3$condition))
w4 <- sqrt(c[]$statistic/length(df3$gender))
pw4 <- pwr.chisq.test(w=w,N=length(df3$InCS),df=(3-1),sig.level = .05)

```

\newpage

This pattern was observed for all scenarios individually with the exception of *Julie and Mark*, which showed no association between experimental condition and cognitive load,  $\chi$^2^(`r c1$parameter`, *N* = `r length(df3$Ju1_bin)`) = `r round(c1$statistic, digits=3)`, *p* `r paste(p_report(c1$p.value))`, *V* = `r w1`, power = `r paste(round(pw1$power,digits=3))`. The association was significant for *Jennifer*  $\chi$^2^(`r c2$parameter`, *N* = `r length(df3$Ju1_bin)`) = `r round(c2$statistic, digits=3)`, *p* `r paste(p_report(c2$p.value))`, *V* = `r w2`, power = `r paste(round(pw2$power,digits=3))`, *Trolley*  $\chi$^2^(`r c3$parameter`, *N* = `r length(df3$Ju1_bin)`) = `r round(c3$statistic, digits=3)`, *p* `r paste(p_report(c3$p.value))`, *V* = `r w3`, power = `r paste(round(pw3$power,digits=3))`, and Heinz,  $\chi$^2^(`r c4$parameter`, *N* = `r length(df3$Ju1_bin)`) = `r round(c4$statistic, digits=3)`, *p* `r paste(p_report(c4$p.value))`, *V* = `r w4`, power = `r paste(round(pw4$power,digits=3))`, see Figure\ \@ref(fig:S6ch5S6fig2criticalconditionb). Supplementary Tables XX-XX show the direction of the effect for each scenario. Under cognitive load, fewer participants provided reasons and more participants provided a dumbfounded response for *Jennifer*, *Trolley*, and *Heinz*


```{r}
#suppressWarnings(print(g))
```


```{r}

df3 <- study_6_clean
#df3$InCS
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]
df3 <- df3[which(df3$scenario=="Incest"),]
y <- table(df3$condition,df3$InCS)
y <- as.data.frame(y)
colnames(y) <- c("condition","InCS","Freq")
z <- as.data.frame(table(df3$condition,df3$InCS)/length(df3$gender)*2)
perc <- z$Freq
test <- cbind(y,perc)
test$condition
incest <- test


df3 <- study_6_clean
#df3$InCS
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]
df3 <- df3[which(df3$scenario=="Jennifer"),]
y <- table(df3$condition,df3$InCS)
y <- as.data.frame(y)
colnames(y) <- c("condition","InCS","Freq")
z <- as.data.frame(table(df3$condition,df3$InCS)/length(df3$gender)*2)
perc <- z$Freq
test <- cbind(y,perc)
test$condition
cannibal <- test


df3 <- study_6_clean
#df3$InCS
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]
df3 <- df3[which(df3$scenario=="Trolley"),]
y <- table(df3$condition,df3$InCS)
y <- as.data.frame(y)
colnames(y) <- c("condition","InCS","Freq")
z <- as.data.frame(table(df3$condition,df3$InCS)/length(df3$gender)*2)
perc <- z$Freq
test <- cbind(y,perc)
test$condition
trolley <- test


df3 <- study_6_clean
#df3$InCS
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]
df3 <- df3[which(df3$scenario=="Heinz"),]
y <- table(df3$condition,df3$InCS)
y <- as.data.frame(y)
colnames(y) <- c("condition","InCS","Freq")
z <- as.data.frame(table(df3$condition,df3$InCS)/length(df3$gender)*2)
perc <- z$Freq
test <- cbind(y,perc)
test$condition
heinz <- test

test <- rbind.data.frame(incest, cannibal, trolley, heinz)

#y <- table(df3$condition,df3$Dumb_incl_string)
#y <- as.data.frame(y)
#colnames(y) <- c("condition","InCS","Freq")

# z <- as.data.frame(table(df3$condition,df3$Dumb_incl_string)/length(df3$gender)*2)
# perc <- z$Freq
# test <- cbind(y,perc)
# test$condition
# test


ab_graph <- function(){
  a <- df3[which(df3$condition==levels(as.factor(df3$condition))[1]),]
  b <- df3[which(df3$condition==levels(as.factor(df3$condition))[2]),]
  a#levels(as.factor(df3$condition))[1]
  
  ay <- as.data.frame(table(a$InCS,as.character(a$condition)))
  by <- as.data.frame(table(b$InCS,as.character(b$condition)))
  
  aperc <- ay$Freq/length(a$gender)
  ay <- cbind(ay,aperc)
  colnames(ay) <- c("InCS","condition","Freq","perc")
  
  bperc <- by$Freq/length(b$gender)
  by <- cbind(by,bperc)
  colnames(by) <- c("InCS","condition","Freq","perc")
  
  c <- rbind(ay,by)
  
  c
}

df3 <- study_6_clean
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]
df3 <- df3[which(df3$scenario=="Incest"),]
test1 <- ab_graph()
test1$scenario <- rep("Julie and Mark",length(test1$InCS))
incest <- test1

df3 <- study_6_clean
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]
df3 <- df3[which(df3$scenario=="Jennifer"),]
test1 <- ab_graph()
test1$scenario <- rep("Jennifer",length(test1$InCS))
cannibal <- test1

df3 <- study_6_clean
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]
df3 <- df3[which(df3$scenario=="Trolley"),]
test1 <- ab_graph()
test1$scenario <- rep("Trolley",length(test1$InCS))
trolley <- test1

df3 <- study_6_clean
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]
df3 <- df3[which(df3$scenario=="Heinz"),]
test1 <- ab_graph()
test1$scenario <- rep("Heinz",length(test1$InCS))
heinz <- test1

df3 <- study_6_clean
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]

test <- rbind.data.frame(incest, cannibal, trolley, heinz)


rm(y)
```




```{r S6ch5S6fig2criticalconditionb, fig.cap="Study 6: Responses to critical slide and for the experimental group and the control group for each scenario", include=TRUE}

#g <- 
ggplot(test, aes(x=InCS, y=perc, fill=factor(condition
                                             ,labels=c("Cognitive load","Control")
                                             ))) +
  facet_wrap(~scenario,scales='free')+
  scale_y_continuous(limits = c(-.05,1),
                     labels = percent_format()
  )+ 
  geom_col(position = "dodge",
           color="black",
           size=.2
  )+
  geom_text(#family = "Times",
            size=2.5,
            aes( label = scales::percent(perc,accuracy = 1),
                 y= perc-.005
                 #, color=factor(scenario)
                 ),
            stat= "identity",
            vjust = -.5,
            position = position_dodge(.9),
            fontface='plain'
            )+
  geom_text(#family = "Times", 
            size=2.5,
            aes(label = format(Freq),
                y= -4.5*(..count../100)/(..count..)
                #, color=factor(scenario)
                ),
            stat= "count",
            position = position_dodge(0.9),
            #vjust = -.05,
            fontface='plain'
            ) +
  xlab("Response to Critical Slide") +
  ylab("Percentage of participants selecting each response")+
  scale_x_discrete(labels=c("Reasons", "Dumbfounded","Nothing Wrong")) +
  scale_fill_grey(start = .5, end = .8) +
  labs(fill="Condition") +
  # 
  # geom_text(#family = "Times", 
  #           size=4.2,
  #           aes( label = scales::percent(test$perc),
  #                y= test$perc ),
  #           stat= "identity",
  #           vjust = -.5,
  #           position = position_dodge(.9),
  #           fontface='plain'
  #           )+
  #theme_apa() +
  theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(size = .2),
        strip.background  = element_blank(),
        panel.grid = element_blank(),
        plot.title=element_text(#family="Times",
                                size=8
                                ),
        legend.text=element_text(#family="Times",
                                 size=6
                                 ),
        legend.title=element_text(#family="Times",
                                    size=8
                                    ),
        axis.text=element_text(#family="Times",
                               colour = "black",
                               size=6
                               ),
        axis.ticks.x = element_blank(),
        axis.title=element_text(#family="Times",
                                size=8
                                ),
        strip.text=element_text(#family = "Times",
                                  size = 8
                                  ),
        #  strip.background = element_rect(fill = "white"),
        legend.position="right")





```

```{r}
#suppressWarnings(print(g))
```

```{r}

#### this didn't work ####
# x <- study_6_clean
# 
# library(nlme)
# library(lme4)
# 
# lme4::glmer()
# 
# x$condition <- as.factor(x$condition)
# x$scenario <- as.factor(x$scenario)
# x$InCS <- as.factor(x$InCS)
# fit <- lme(InCS ~ condition + scenario, data = x)
# summary(fit)
# 
# ### save this for the combined analysis
# glmm = glmer(InCS ~ condition + (1|study), data=x,family=binomial)
# summary(glmm)

```


```{r}
c <- chisq.test(table(df3$InCS,df3$scenario))
w <- sqrt(c[]$statistic/length(df3$gender))
pw <- pwr.chisq.test(w=w,N=length(df3$InCS),df=(6-1),sig.level = .05)

c$residuals

paste(p_report(2*(1-pnorm(sqrt(c$residuals[[6]]^2)))))
paste(p_report(2*(1-pnorm(sqrt(c$residuals[[7]]^2)))))
paste(p_report(2*(1-pnorm(sqrt(c$residuals[[9]]^2)))))
paste(p_report(2*(1-pnorm(sqrt(c$residuals[[11]]^2)))))


c$residuals[[6]]
c$residuals[[7]]
c$residuals[[9]]
c$residuals[[11]]


```

A chi-squared test for independence revealed a significant association between scenario and response to the critical slide, $\chi$^2^(`r c$parameter`, *N* = `r length(df3$Ju1_bin)`) = `r round(c$statistic, digits=3)`, *p* `r paste(p_report(c$p.value))`, *V* = `r w`, the observed power was `r paste(round(pw$power,digits=3))`. Participants were significantly more likely to select "There is nothing wrong" for *Julie and Mark* (*p* `r paste(p_report(2*(1-pnorm(sqrt(c$residuals[[6]]^2)))))`), more likely to provide reasons (*p* `r paste(p_report(2*(1-pnorm(sqrt(c$residuals[[7]]^2)))))`) and less likely to select "There is nothing wrong" (*p* `r paste(p_report(2*(1-pnorm(sqrt(c$residuals[[9]]^2)))))`) for Jennifer, and more likely to be dumbfounded by *Trolley* (*p* `r paste(p_report(2*(1-pnorm(sqrt(c$residuals[[11]]^2)))))`).

```{r}

# 
# 
# df3 <- study_6_clean
# 
# 
# glm(InCS~InJu1, data=x, family = 'binomial')
# 
# df3$InCS <- relevel(df3$InCS, ref = 2)
# 
# glm_model<-lme4::glmer(InCS ~ condition*scenario + (1 | scenario),
#                   data = x
#                   #reflevel = "It's wrong and I can provide a valid reason."
#                   ,family=binomial)
# 
# glm_model
# summary(glm_model)
# 
# 
# 
df3a <- mlogit.data(df3, choice = "InCS", shape = "wide")
InCSModel<-mlogit(InCS ~ 1 | condition+scenario,
                  data = df3a,
                  reflevel = "It's wrong and I can provide a valid reason."
                  )
# InCSModel<-mlogit(InCS ~ 1 | InJu1,
#                   data = df3a,
#                   reflevel = "It's wrong and I can provide a valid reason."
#                   )

# InCSModel<-mlogit(InCS ~ 1 | condition+scenario,
#                   data = df3a,
#                   reflevel = "It's wrong but I can't think of a reason."
#                   )

summary_InCS_model <- summary(InCSModel)

summary_InCS_model



summary_InCS_model <- summary(InCSModel)
summary_InCS_model$lratio$parameter
summary_InCS_model$lratio$statistic
summary_InCS_model$lratio$p.value

InCSModel$coefficients[3]
InCSModel$coefficients[4]

InCSModel$coefficients
summary_InCS_model$CoefTable
summary_InCS_model$CoefTable[13]
cox <- PseudoR2(multinom(InCS~condition*scenario,df3), "all")


round(cox[3])
cox[4]
#PseudoR2(x, "all")
#summary_InCS_model


wald1 <-
  summary_InCS_model$CoefTable[3]^2 /
  summary_InCS_model$CoefTable[13]^2

wald2 <-
  summary_InCS_model$CoefTable[4]^2 /
  summary_InCS_model$CoefTable[14]^2

wald3 <-
  summary_InCS_model$CoefTable[8]^2 /
  summary_InCS_model$CoefTable[18]^2

wald4 <-
  summary_InCS_model$CoefTable[9]^2 /
  summary_InCS_model$CoefTable[19]^2

summary_InCS_model
summary_InCS_model$coefficients[3]
data.frame(exp(InCSModel$coefficients))

exp(InCSModel$coefficients)[3]

exp(InCSModel$coefficients)[4]
a <- exp(confint(InCSModel))
a

c(a[3],a[7])

residuals(InCSModel)
fitted(InCSModel, outcome = F)

c <- summary_InCS_model$lratio$statistic
w <- sqrt(c/length(df3$gender))
pw <- pwr.chisq.test(w=w,N=length(df3$InCS),df=(5),sig.level = .05)

pw$power

revised_PseudoR2s <- function(LogModel) {
  dev <- LogModel$deviance
  nullDev <- LogModel$null.deviance
  modelN <- length(LogModel$fitted.values)
  R.l <- 1 - dev / nullDev
  R.cs <- 1- exp ( -(nullDev - dev) / modelN)
  R.n <- R.cs / ( 1 - ( exp (-(nullDev / modelN))))

  all <- list(hosmer_and_lemeshow = as.numeric(R.l), mcfadden = NA, cox_and_snell = as.numeric(R.cs), nagelkerke = as.numeric(R.n))
  all
}

#logits_rsquared <- glm(InCS~condition+scenario,df3, family = binomial(link = "logit"))
#cox <- revised_PseudoR2s(logits_rsquared)

pw
wald1

pw$power
```

A multinomial logistic regression was conducted to test the effects of cognitive load and scenario on dumbfounded responding. Overall the model was significant, $\chi$^2^(`r summary_InCS_model$lratio$parameter`, *N* = `r length(df3$gender)`) = `r round(summary_InCS_model$lratio$statistic, digits=2)`, *p* `r paste(p_report(summary_InCS_model$lratio$p.value))`, and explained between `r round(cox[3]*100,digits=2)`% (Cox and Snell R square) and `r round(cox[4]*100, digits=2)`% (Nadelkerke R squared) of the variance in responses to the critical slide, the observed power was `r round(pw$power,digits=7)`. Participants in the control condition were significantly less likely to provide a dumbfounded response than to provide reasons, Wald = `r round(wald1,digits=2)`, *p* `r paste(p_report(summary_InCS_model$CoefTable[33]))`, *OR* = `r exp(InCSModel$coefficients)[3]`, 95% CI [`r a[3]`, `r a[13]`], in addition, participants in the control condition were also signifcantly less likely to select "There is nothing wrong", than to provide reasons, Wald = `r round(wald2,digits=2)`, *p* `r paste(p_report(summary_InCS_model$CoefTable[34]))`, *OR* = `r exp(InCSModel$coefficients)[4]`, 95% CI [`r a[4]`, `r a[14]`]. For *Jennifer*, participants were significantly less likely to select "There is nothing wrong" than to provide a reason, Wald = `r round(wald3,digits=2)`, *p* `r paste(p_report(summary_InCS_model$CoefTable[38]))`, *OR* = `r exp(InCSModel$coefficients)[8]`, 95% CI [`r a[8]`, `r a[18]`]; while for *Trolley* participants were significantly more likely to present as dumbfounded than to provide a reason, Wald = `r round(wald4,digits=2)`, *p* `r paste(p_report(summary_InCS_model$CoefTable[39]))`, *OR* = `r exp(InCSModel$coefficients)[9]`, 95% CI [`r a[9]`, `r a[19]`].



```{r}
df3 <- study_6_clean
#df3$InCS
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]

df3 <- df3[which(df3$scenario=="Incest"),]

df4 <- df3[which(df3$condition=="cog_load"),]
df5 <- df3[which(df3$condition=="control"),]

```

```{r S6checkingchanges6aIncest, include=FALSE}

length(df3$gender)
table(df3$condition)
#table(df3$condition,df3$scenario)

```


```{r S6checkingchanges6Incest, include=FALSE}
chisq.test(table(df3$InCS,df3$condition),correct = TRUE)
```


```{r}

test <- as.data.frame.matrix((table(df3$InCS,df3$condition)))
`rownames<-`(test, c("nothing wrong","no reason","reasons"))
test <- as.matrix((test))
test1 <- cbind(test[,1],test[,2])
test2 <- `colnames<-`(test1, c("cognitive load","control"))

tb_count_perc <- function(x){
  tc <- table(x$InCS,x$condition)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$condition=="cog_load")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$condition=="control")*100),"%"))
  }
  
  tb_count_perc_eng <- function(x){
  tc <- table(x$InCS,x$engaged)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$engaged=="engaged")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$engaged=="not engaged")*100),"%"))
  }
  
test <- tb_count_perc(df3)
test <- as.data.frame(test)
colnames(test) <- c("N","\\%","N","\\%")

  makespanners <- function(){
  cog_load <- c(2,3)
  control <- c(4,5)
  spans <- list(cog_load,control)
  names(spans) <- c("Cognitive Load","Control")
  spans
}

#test <- tb_count_perc(df3)
#tb_count_perc(df3a)



```


```{r S6tab1dumb1allIncest,results = 'asis', include=FALSE}


apa_table(
   test
   , align = c("l", "c", "c", "c", "c")
   , caption = "Study 6 – Response to the critical slide depending on cognitive load (Julie and Mark)"
   #, added_stub_head = "Response to critical slide"
   , col_spanners = makespanners()
   #, note = "* = sig. at \\emph{p} < .05; ** = sig. at \\emph{p} < .001"
   , escape = FALSE
   
)

```


```{r}


y <- table(df3$condition,df3$InCS)
y <- as.data.frame(y)
colnames(y) <- c("condition","InCS","Freq")

z <- as.data.frame(table(df3$condition,df3$InCS)/length(df3$gender)*2)
perc <- z$Freq
test <- cbind(y,perc)
test$condition
test


#y <- table(df3$condition,df3$Dumb_incl_string)
#y <- as.data.frame(y)
#colnames(y) <- c("condition","InCS","Freq")

# z <- as.data.frame(table(df3$condition,df3$Dumb_incl_string)/length(df3$gender)*2)
# perc <- z$Freq
# test <- cbind(y,perc)
# test$condition
# test


ab_graph <- function(){
  a <- df3[which(df3$condition==levels(as.factor(df3$condition))[1]),]
  b <- df3[which(df3$condition==levels(as.factor(df3$condition))[2]),]
  a#levels(as.factor(df3$condition))[1]
  
  ay <- as.data.frame(table(a$InCS,as.character(a$condition)))
  by <- as.data.frame(table(b$InCS,as.character(b$condition)))
  
  aperc <- ay$Freq/length(a$gender)
  ay <- cbind(ay,aperc)
  colnames(ay) <- c("InCS","condition","Freq","perc")
  
  bperc <- by$Freq/length(b$gender)
  by <- cbind(by,bperc)
  colnames(by) <- c("InCS","condition","Freq","perc")
  
  c <- rbind(ay,by)
  
  c
}

test <- ab_graph()



rm(y)
```


```{r S6ch5S6fig2criticalconditionbIncest, fig.cap="Study 6: Responses to critical slide depending on cognitive load (Julie and Mark)", include=FALSE}

ggplot(test, aes(x=reorder(InCS), y=perc, fill=factor(condition,labels=c("Cognitive load","Control")))) +
  scale_y_continuous(limits = c(-.03,1),
                     labels = percent_format()
  )+ 
  geom_col(position = "dodge",
           color="black",
           size=.2
  )+
  geom_text(#family = "Times",
    size=4.2,
    aes( label = scales::percent(perc, accuracy = 1),
         y= perc ),
    stat= "identity",
    vjust = -.5,
    position = position_dodge(.9),
    fontface='plain'
  )+
  geom_text(#family = "Times", 
    size=4.2,
    aes(label = format(Freq),
        y= -3*(..count../100)/(..count..)),
    stat= "count",
    position = position_dodge(0.9),
    #vjust = -.05,
    fontface='plain'
  ) +
  xlab("Response to Critical Slide") +
  ylab("Percentage of participants selecting each response")+
  scale_x_discrete(labels=c("Reasons", "Dumbfounded","Nothing Wrong")) +
  scale_fill_grey(start = .5, end = .8) +
  labs(fill="Condition") +
  #theme_apa() +
  theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(size = .2),
        strip.background  = element_blank(),
        panel.grid = element_blank(),
        plot.title=element_text(#family="Times",
          size=12
        ),
        legend.text=element_text(#family="Times",
          size=8
        ),
        legend.title=element_text(#family="Times",
          size=10
        ),
        axis.text=element_text(#family="Times",
          colour = "black",
          size=8
        ),
        axis.ticks.x = element_blank(),
        axis.title=element_text(#family="Times",
          size=12
        ),
        strip.text=element_text(#family = "Times",
          size = 12
        ),
        #strip.background = element_rect(fill = "white"),
        legend.position="right")






```



```{r}
c <- chisq.test(table(df3$InCS,df3$condition))
rownames(rbind(c$observed,c$expected,c$stdres))



ps <- function(y){
  if(as.numeric(sqrt( y*y) ) >3.3) print(paste0(y,"**"), quote = FALSE)
  else if(as.numeric(sqrt( y*y) ) >1.96) print(paste0(y,"*"), quote = FALSE)
  else print(y)}


x <- c$stdres
x <- round(x, digits = 2)

lapply(x, ps)

#c$stdres <- round(c$stdres,digits=3)
#c$stdres <- ps(c$stdres)

ps(x[1])
ps(x[2])
ps(x[3])

x <- `colnames<-`(
  cbind.data.frame(c(ps(x[1]),ps(x[2]),ps(x[3])),
                   c(ps(x[4]),ps(x[5]),ps(x[6]))),
  c("cog_load","control")
)

rownames(x) <- row.names(c$observed)  

y <- rbind(round(c$observed), round(c$expected, digits = 2))

c(c$stdres[1])


res <- cbind(c("Observed count","","","Expected count","","","Standardised residuals","",""),
      c("Reasons","Dumbfounded","Nothing Wrong",
        "Reasons","Dumbfounded","Nothing Wrong",
        "Reasons","Dumbfounded","Nothing Wrong"),
      rbind(y,x)
      
      )

row.names(res) <- NULL
colnames(res) <- c("","","Cognitive Load","Control")




```



```{r S6tab1dumbIncest,results = 'asis', include=FALSE}


apa_table(
   res
   , align = c("l", "l", "c", "c", "c")
   , caption = "Study 6 – Observed counts, expected counts, and standardised residuals for each response to the critical slide depending on cognitive load (Julie and Mark)"
   #, added_stub_head = "Response to critical slide"
   #, col_spanners = makespanners()
   , note = "* = sig. at \\emph{p} < .05; ** = sig. at \\emph{p} < .001"
   , escape = FALSE
   
)

```


```{r}
df3 <- study_6_clean
#df3$InCS
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]

df3 <- df3[which(df3$scenario=="Jennifer"),]

df4 <- df3[which(df3$condition=="cog_load"),]
df5 <- df3[which(df3$condition=="control"),]

```

```{r S6checkingchanges6aJennifer, include=FALSE}

length(df3$gender)
table(df3$condition)
#table(df3$condition,df3$scenario)

```


```{r S6checkingchanges6Jennifer, include=FALSE}
chisq.test(table(df3$InCS,df3$condition),correct = TRUE)
```


```{r}

test <- as.data.frame.matrix((table(df3$InCS,df3$condition)))
`rownames<-`(test, c("nothing wrong","no reason","reasons"))
test <- as.matrix((test))
test1 <- cbind(test[,1],test[,2])
test2 <- `colnames<-`(test1, c("cognitive load","control"))

tb_count_perc <- function(x){
  tc <- table(x$InCS,x$condition)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$condition=="cog_load")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$condition=="control")*100),"%"))
  }
  
  tb_count_perc_eng <- function(x){
  tc <- table(x$InCS,x$engaged)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$engaged=="engaged")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$engaged=="not engaged")*100),"%"))
  }
  
test <- tb_count_perc(df3)
test <- as.data.frame(test)
colnames(test) <- c("N","\\%","N","\\%")

  makespanners <- function(){
  cog_load <- c(2,3)
  control <- c(4,5)
  spans <- list(cog_load,control)
  names(spans) <- c("Cognitive Load","Control")
  spans
}

#test <- tb_count_perc(df3)
#tb_count_perc(df3a)



```


```{r S6tab1dumb1allJennifer,results = 'asis', include=FALSE}


apa_table(
   test
   , align = c("l", "l", "c", "c", "c")
   , caption = "Study 6 – Response to the critical slide depending on cognitive load (Jennifer)"
   #, added_stub_head = "Response to critical slide"
   , col_spanners = makespanners()
   #, note = "* = sig. at \\emph{p} < .05; ** = sig. at \\emph{p} < .001"
   , escape = FALSE
   
)

```


```{r}


y <- table(df3$condition,df3$InCS)
y <- as.data.frame(y)
colnames(y) <- c("condition","InCS","Freq")

z <- as.data.frame(table(df3$condition,df3$InCS)/length(df3$gender)*2)
perc <- z$Freq
test <- cbind(y,perc)
test$condition
test


#y <- table(df3$condition,df3$Dumb_incl_string)
#y <- as.data.frame(y)
#colnames(y) <- c("condition","InCS","Freq")

# z <- as.data.frame(table(df3$condition,df3$Dumb_incl_string)/length(df3$gender)*2)
# perc <- z$Freq
# test <- cbind(y,perc)
# test$condition
# test


ab_graph <- function(){
  a <- df3[which(df3$condition==levels(as.factor(df3$condition))[1]),]
  b <- df3[which(df3$condition==levels(as.factor(df3$condition))[2]),]
  a#levels(as.factor(df3$condition))[1]
  
  ay <- as.data.frame(table(a$InCS,as.character(a$condition)))
  by <- as.data.frame(table(b$InCS,as.character(b$condition)))
  
  aperc <- ay$Freq/length(a$gender)
  ay <- cbind(ay,aperc)
  colnames(ay) <- c("InCS","condition","Freq","perc")
  
  bperc <- by$Freq/length(b$gender)
  by <- cbind(by,bperc)
  colnames(by) <- c("InCS","condition","Freq","perc")
  
  c <- rbind(ay,by)
  
  c
}

test <- ab_graph()



rm(y)
```


```{r S6ch5S6fig2criticalconditionbJennifer, fig.cap="Study 6: Responses to critical slide depending on cognitive load (Jennifer)", include=FALSE}


ggplot(test, aes(x=reorder(InCS), y=perc, fill=factor(condition,labels=c("Cognitive load","Control")))) +
  scale_y_continuous(limits = c(-.03,1),
                     labels = percent_format()
  )+ 
  geom_col(position = "dodge",
           color="black",
           size=.2
  )+
  geom_text(#family = "Times",
    size=4.2,
    aes( label = scales::percent(perc, accuracy = 1),
         y= perc ),
    stat= "identity",
    vjust = -.5,
    position = position_dodge(.9),
    fontface='plain'
  )+
  geom_text(#family = "Times", 
    size=4.2,
    aes(label = format(Freq),
        y= -3*(..count../100)/(..count..)),
    stat= "count",
    position = position_dodge(0.9),
    #vjust = -.05,
    fontface='plain'
  ) +
  xlab("Response to Critical Slide") +
  ylab("Percentage of participants selecting each response")+
  scale_x_discrete(labels=c("Reasons", "Dumbfounded","Nothing Wrong")) +
  scale_fill_grey(start = .5, end = .8) +
  labs(fill="Condition") +
  #theme_apa() +
  theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(size = .2),
        strip.background  = element_blank(),
        panel.grid = element_blank(),
        plot.title=element_text(#family="Times",
          size=12
        ),
        legend.text=element_text(#family="Times",
          size=8
        ),
        legend.title=element_text(#family="Times",
          size=10
        ),
        axis.text=element_text(#family="Times",
          colour = "black",
          size=8
        ),
        axis.ticks.x = element_blank(),
        axis.title=element_text(#family="Times",
          size=12
        ),
        strip.text=element_text(#family = "Times",
          size = 12
        ),
        #strip.background = element_rect(fill = "white"),
        legend.position="right")






```



```{r}
c <- chisq.test(table(df3$InCS,df3$condition))
rownames(rbind(c$observed,c$expected,c$stdres))



ps <- function(y){
  if(as.numeric(sqrt( y*y) ) >3.3) print(paste0(y,"**"), quote = FALSE)
  else if(as.numeric(sqrt( y*y) ) >1.96) print(paste0(y,"*"), quote = FALSE)
  else print(y)}


x <- c$stdres
x <- round(x, digits = 2)

lapply(x, ps)

#c$stdres <- round(c$stdres,digits=3)
#c$stdres <- ps(c$stdres)

ps(x[1])
ps(x[2])
ps(x[3])

x <- `colnames<-`(
  cbind.data.frame(c(ps(x[1]),ps(x[2]),ps(x[3])),
                   c(ps(x[4]),ps(x[5]),ps(x[6]))),
  c("cog_load","control")
)

rownames(x) <- row.names(c$observed)  

y <- rbind(round(c$observed), round(c$expected, digits = 2))

c(c$stdres[1])


res <- cbind(c("Observed count","","","Expected count","","","Standardised residuals","",""),
      c("Reasons","Dumbfounded","Nothing Wrong",
        "Reasons","Dumbfounded","Nothing Wrong",
        "Reasons","Dumbfounded","Nothing Wrong"),
      rbind(y,x)
      
      )

row.names(res) <- NULL
colnames(res) <- c("","","Cognitive Load","Control")




```



```{r S6tab1dumbJennifer,results = 'asis', include=FALSE}


apa_table(
   res
   , align = c("l", "l", "c", "c", "c")
   , caption = "Study 6 – Observed counts, expected counts, and standardised residuals for each response to the critical slide depending on cognitive load (Julie and Mark)"
   #, added_stub_head = "Response to critical slide"
   #, col_spanners = makespanners()
   , note = "* = sig. at \\emph{p} < .05; ** = sig. at \\emph{p} < .001"
   , escape = FALSE
   
)

```

```{r}
df3 <- study_6_clean
#df3$InCS
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]

df3 <- df3[which(df3$scenario=="Trolley"),]

df4 <- df3[which(df3$condition=="cog_load"),]
df5 <- df3[which(df3$condition=="control"),]

```

```{r S6checkingchanges6aTrolley, include=FALSE}

length(df3$gender)
table(df3$condition)
#table(df3$condition,df3$scenario)

```


```{r checkingchanges6Trolley, include=FALSE}
chisq.test(table(df3$InCS,df3$condition),correct = TRUE)
```


```{r}

test <- as.data.frame.matrix((table(df3$InCS,df3$condition)))
`rownames<-`(test, c("nothing wrong","no reason","reasons"))
test <- as.matrix((test))
test1 <- cbind(test[,1],test[,2])
test2 <- `colnames<-`(test1, c("cognitive load","control"))

tb_count_perc <- function(x){
  tc <- table(x$InCS,x$condition)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$condition=="cog_load")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$condition=="control")*100),"%"))
  }
  
  tb_count_perc_eng <- function(x){
  tc <- table(x$InCS,x$engaged)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$engaged=="engaged")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$engaged=="not engaged")*100),"%"))
  }
  

test <- tb_count_perc(df3)
test <- as.data.frame(test)
colnames(test) <- c("N","\\%","N","\\%")

  makespanners <- function(){
  cog_load <- c(2,3)
  control <- c(4,5)
  spans <- list(cog_load,control)
  names(spans) <- c("Cognitive Load","Control")
  spans
}

#test <- tb_count_perc(df3)
#tb_count_perc(df3a)



```


```{r S6tab1dumb1allTrolley,results = 'asis', include=FALSE}


apa_table(
   test
   , align = c("l", "l", "c", "c", "c")
   , caption = "Study 6 – Response to the critical slide depending on cognitive load (Trolley)"
   #, added_stub_head = "Response to critical slide"
   , col_spanners = makespanners()
   #, note = "* = sig. at \\emph{p} < .05; ** = sig. at \\emph{p} < .001"
   , escape = FALSE
   
)

```


```{r}


y <- table(df3$condition,df3$InCS)
y <- as.data.frame(y)
colnames(y) <- c("condition","InCS","Freq")

z <- as.data.frame(table(df3$condition,df3$InCS)/length(df3$gender)*2)
perc <- z$Freq
test <- cbind(y,perc)
test$condition
test


#y <- table(df3$condition,df3$Dumb_incl_string)
#y <- as.data.frame(y)
#colnames(y) <- c("condition","InCS","Freq")

# z <- as.data.frame(table(df3$condition,df3$Dumb_incl_string)/length(df3$gender)*2)
# perc <- z$Freq
# test <- cbind(y,perc)
# test$condition
# test


ab_graph <- function(){
  a <- df3[which(df3$condition==levels(as.factor(df3$condition))[1]),]
  b <- df3[which(df3$condition==levels(as.factor(df3$condition))[2]),]
  a#levels(as.factor(df3$condition))[1]
  
  ay <- as.data.frame(table(a$InCS,as.character(a$condition)))
  by <- as.data.frame(table(b$InCS,as.character(b$condition)))
  
  aperc <- ay$Freq/length(a$gender)
  ay <- cbind(ay,aperc)
  colnames(ay) <- c("InCS","condition","Freq","perc")
  
  bperc <- by$Freq/length(b$gender)
  by <- cbind(by,bperc)
  colnames(by) <- c("InCS","condition","Freq","perc")
  
  c <- rbind(ay,by)
  
  c
}

test <- ab_graph()



rm(y)
```


```{r S6ch5S6fig2criticalconditionbTrolley, fig.cap="Study 6: Responses to critical slide depending on cognitive load (Trolley)", include=FALSE}


ggplot(test, aes(x=reorder(InCS), y=perc, fill=factor(condition,labels=c("Cognitive load","Control")))) +
  scale_y_continuous(limits = c(-.03,1),
                     labels = percent_format()
  )+ 
  geom_col(position = "dodge",
           color="black",
           size=.2
  )+
  geom_text(#family = "Times",
    size=4.2,
    aes( label = scales::percent(perc, accuracy = 1),
         y= perc ),
    stat= "identity",
    vjust = -.5,
    position = position_dodge(.9),
    fontface='plain'
  )+
  geom_text(#family = "Times", 
    size=4.2,
    aes(label = format(Freq),
        y= -3*(..count../100)/(..count..)),
    stat= "count",
    position = position_dodge(0.9),
    #vjust = -.05,
    fontface='plain'
  ) +
  xlab("Response to Critical Slide") +
  ylab("Percentage of participants selecting each response")+
  scale_x_discrete(labels=c("Reasons", "Dumbfounded","Nothing Wrong")) +
  scale_fill_grey(start = .5, end = .8) +
  labs(fill="Condition") +
  #theme_apa() +
  theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(size = .2),
        strip.background  = element_blank(),
        panel.grid = element_blank(),
        plot.title=element_text(#family="Times",
          size=12
        ),
        legend.text=element_text(#family="Times",
          size=8
        ),
        legend.title=element_text(#family="Times",
          size=10
        ),
        axis.text=element_text(#family="Times",
          colour = "black",
          size=8
        ),
        axis.ticks.x = element_blank(),
        axis.title=element_text(#family="Times",
          size=12
        ),
        strip.text=element_text(#family = "Times",
          size = 12
        ),
        #strip.background = element_rect(fill = "white"),
        legend.position="right")






```



```{r}
c <- chisq.test(table(df3$InCS,df3$condition))
rownames(rbind(c$observed,c$expected,c$stdres))



ps <- function(y){
  if(as.numeric(sqrt( y*y) ) >3.3) print(paste0(y,"**"), quote = FALSE)
  else if(as.numeric(sqrt( y*y) ) >1.96) print(paste0(y,"*"), quote = FALSE)
  else print(y)}


x <- c$stdres
x <- round(x, digits = 2)

lapply(x, ps)

#c$stdres <- round(c$stdres,digits=3)
#c$stdres <- ps(c$stdres)

ps(x[1])
ps(x[2])
ps(x[3])

x <- `colnames<-`(
  cbind.data.frame(c(ps(x[1]),ps(x[2]),ps(x[3])),
                   c(ps(x[4]),ps(x[5]),ps(x[6]))),
  c("cog_load","control")
)

rownames(x) <- row.names(c$observed)  

y <- rbind(round(c$observed), round(c$expected, digits = 2))

c(c$stdres[1])


res <- cbind(c("Observed count","","","Expected count","","","Standardised residuals","",""),
      c("Reasons","Dumbfounded","Nothing Wrong",
        "Reasons","Dumbfounded","Nothing Wrong",
        "Reasons","Dumbfounded","Nothing Wrong"),
      rbind(y,x)
      
      )

row.names(res) <- NULL
colnames(res) <- c("","","Cognitive Load","Control")




```



```{r S6tab1dumbTrolley,results = 'asis', include=FALSE}


apa_table(
   res
   , align = c("l", "l", "c", "c", "c")
   , caption = "Study 6 – Observed counts, expected counts, and standardised residuals for each response to the critical slide depending on cognitive load (Trolley)"
   #, added_stub_head = "Response to critical slide"
   #, col_spanners = makespanners()
   , note = "* = sig. at \\emph{p} < .05; ** = sig. at \\emph{p} < .001"
   , escape = FALSE
   
)

```

```{r}
df3 <- study_6_clean
#df3$InCS
df3 <- df3[which(is.na(df3$InCS)==FALSE),]
df3 <- df3[which(df3$InCS!="null"),]

df3 <- df3[which(df3$scenario=="Heinz"),]

df4 <- df3[which(df3$condition=="cog_load"),]
df5 <- df3[which(df3$condition=="control"),]

```

```{r S6checkingchanges6aHeinz, include=FALSE}

length(df3$gender)
table(df3$condition)
#table(df3$condition,df3$scenario)

```


```{r S6checkingchanges6Heinz, include=FALSE}
chisq.test(table(df3$InCS,df3$condition),correct = TRUE)
```


```{r}

test <- as.data.frame.matrix((table(df3$InCS,df3$condition)))
`rownames<-`(test, c("nothing wrong","no reason","reasons"))
test <- as.matrix((test))
test1 <- cbind(test[,1],test[,2])
test2 <- `colnames<-`(test1, c("cognitive load","control"))

tb_count_perc <- function(x){
  tc <- table(x$InCS,x$condition)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$condition=="cog_load")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$condition=="control")*100),"%"))
  }
  
  tb_count_perc_eng <- function(x){
  tc <- table(x$InCS,x$engaged)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$engaged=="engaged")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$engaged=="not engaged")*100),"%"))
  }
  
test <- tb_count_perc(df3)
test <- as.data.frame(test)
colnames(test) <- c("N","\\%","N","\\%")
  
  makespanners <- function(){
  cog_load <- c(2,3)
  control <- c(4,5)
  spans <- list(cog_load,control)
  names(spans) <- c("Cognitive Load","Control")
  spans
}

#test <- tb_count_perc(df3)
#tb_count_perc(df3a)



```


```{r S6tab1dumb1allHeinz,results = 'asis', include=FALSE}


apa_table(
   test
   , align = c("l", "l", "c", "c", "c")
   , caption = "Study 6 – Response to the critical slide depending on cognitive load (Heinz)"
   #, added_stub_head = "Response to critical slide"
   , col_spanners = makespanners()
   #, note = "* = sig. at \\emph{p} < .05; ** = sig. at \\emph{p} < .001"
   , escape = FALSE
   
)

```


```{r}


y <- table(df3$condition,df3$InCS)
y <- as.data.frame(y)
colnames(y) <- c("condition","InCS","Freq")

z <- as.data.frame(table(df3$condition,df3$InCS)/length(df3$gender)*2)
perc <- z$Freq
test <- cbind(y,perc)
test$condition
test


#y <- table(df3$condition,df3$Dumb_incl_string)
#y <- as.data.frame(y)
#colnames(y) <- c("condition","InCS","Freq")

# z <- as.data.frame(table(df3$condition,df3$Dumb_incl_string)/length(df3$gender)*2)
# perc <- z$Freq
# test <- cbind(y,perc)
# test$condition
# test


ab_graph <- function(){
  a <- df3[which(df3$condition==levels(as.factor(df3$condition))[1]),]
  b <- df3[which(df3$condition==levels(as.factor(df3$condition))[2]),]
  a#levels(as.factor(df3$condition))[1]
  
  ay <- as.data.frame(table(a$InCS,as.character(a$condition)))
  by <- as.data.frame(table(b$InCS,as.character(b$condition)))
  
  aperc <- ay$Freq/length(a$gender)
  ay <- cbind(ay,aperc)
  colnames(ay) <- c("InCS","condition","Freq","perc")
  
  bperc <- by$Freq/length(b$gender)
  by <- cbind(by,bperc)
  colnames(by) <- c("InCS","condition","Freq","perc")
  
  c <- rbind(ay,by)
  
  c
}

test <- ab_graph()



rm(y)
```


```{r S6ch5S6fig2criticalconditionbHeinz, fig.cap="Study 6: Responses to critical slide depending on cognitive load (Heinz)", include=FALSE}


ggplot(test, aes(x=reorder(InCS), y=perc, fill=factor(condition,labels=c("Cognitive load","Control")))) +
  scale_y_continuous(limits = c(-.03,1),
                     labels = percent_format()
  )+ 
  geom_col(position = "dodge",
           color="black",
           size=.2
  )+
  geom_text(#family = "Times",
    size=4.2,
    aes( label = scales::percent(perc, accuracy = 1),
         y= perc ),
    stat= "identity",
    vjust = -.5,
    position = position_dodge(.9),
    fontface='plain'
  )+
  geom_text(#family = "Times", 
    size=4.2,
    aes(label = format(Freq),
        y= -3*(..count../100)/(..count..)),
    stat= "count",
    position = position_dodge(0.9),
    #vjust = -.05,
    fontface='plain'
  ) +
  xlab("Response to Critical Slide") +
  ylab("Percentage of participants selecting each response")+
  scale_x_discrete(labels=c("Reasons", "Dumbfounded","Nothing Wrong")) +
  scale_fill_grey(start = .5, end = .8) +
  labs(fill="Condition") +
  #theme_apa() +
  theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(size = .2),
        strip.background  = element_blank(),
        panel.grid = element_blank(),
        plot.title=element_text(#family="Times",
          size=12
        ),
        legend.text=element_text(#family="Times",
          size=8
        ),
        legend.title=element_text(#family="Times",
          size=10
        ),
        axis.text=element_text(#family="Times",
          colour = "black",
          size=8
        ),
        axis.ticks.x = element_blank(),
        axis.title=element_text(#family="Times",
          size=12
        ),
        strip.text=element_text(#family = "Times",
          size = 12
        ),
        #strip.background = element_rect(fill = "white"),
        legend.position="right")




```


```{r}
c <- chisq.test(table(df3$InCS,df3$condition))
rownames(rbind(c$observed,c$expected,c$stdres))



ps <- function(y){
  if(as.numeric(sqrt( y*y) ) >3.3) print(paste0(y,"**"), quote = FALSE)
  else if(as.numeric(sqrt( y*y) ) >1.96) print(paste0(y,"*"), quote = FALSE)
  else print(y)}


x <- c$stdres
x <- round(x, digits = 2)

lapply(x, ps)

#c$stdres <- round(c$stdres,digits=3)
#c$stdres <- ps(c$stdres)

ps(x[1])
ps(x[2])
ps(x[3])

x <- `colnames<-`(
  cbind.data.frame(c(ps(x[1]),ps(x[2]),ps(x[3])),
                   c(ps(x[4]),ps(x[5]),ps(x[6]))),
  c("cog_load","control")
)

rownames(x) <- row.names(c$observed)  

y <- rbind(round(c$observed), round(c$expected, digits = 2))

c(c$stdres[1])


res <- cbind(c("Observed count","","","Expected count","","","Standardised residuals","",""),
      c("Reasons","Dumbfounded","Nothing Wrong",
        "Reasons","Dumbfounded","Nothing Wrong",
        "Reasons","Dumbfounded","Nothing Wrong"),
      rbind(y,x)
      
      )

row.names(res) <- NULL
colnames(res) <- c("","","Cognitive Load","Control")




```



```{r S6tab1dumbHeinz,results = 'asis', include=FALSE}


apa_table(
   res
   , align = c("l", "l", "c", "c", "c")
   , caption = "Study 6 – Observed counts, expected counts, and standardised residuals for each response to the critical slide depending on cognitive load (Heinz)"
   #, added_stub_head = "Response to critical slide"
   #, col_spanners = makespanners()
   , note = "* = sig. at \\emph{p} < .05; ** = sig. at \\emph{p} < .001"
   , escape = FALSE
   
)

```

