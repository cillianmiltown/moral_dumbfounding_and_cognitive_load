---
title             : "Understanding Moral Dumbfounding: Cognitive Load Increases the Liklihood of Moral Dumbfounding"
shorttitle        : "Cognitive Load and Moral Dumbfounding"
author:
  - name          : "Blinded"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Blinded"
    email         : "Blinded"
  - name          : "Blinded"
    affiliation   : "2"
  - name          : "Blinded"
    affiliation   : "1"
  - name          : "Blinded"
    affiliation   : "1"
affiliation:
  - id            : "1"
    institution   : "Blinded"
  - id            : "2"
    institution   : "Blinded"
author_note: >
  All procedures performed in studies involving human participants were approved by institutional research ethics committee and conducted in accordance with the Code of Professional Ethics of the Psychological Society of Ireland, and with the 1964 Helsinki declaration and its later amendments or comparable ethical standards. Informed consent was obtained from all individual participants included in the study. The authors declare that there are no potential conflicts of interest with respect to the research, authorship, and/or publication of this article. All authors consented to the submission of this manuscript.
abstract: >
  Six studies etc.
keywords          : "keywords"
wordcount         : "TBC"
bibliography: "../resources/bib/My Library.bib"
csl: "../resources/bib/apa6.csl"
figsintext        : yes
figurelist        : no
tablelist         : no
footnotelist      : no
lineno            : no
toc               : no
lang              : "en-US"
documentclass     : "apa7"
output:
  papaja::apa6_word
editor_options: 
  chunk_output_type: inline
---

```{r}
library(citr)
#install.packages("sjstats")
library(plyr)
library(foreign)
library(car)
library(desnum)
library(ggplot2)
library(extrafont)
#devtools::install_github("crsh/papaja")
library(papaja)
#library("dplyr")
library("afex")
library("tibble")
library(scales)
#install.packages("metap")
library(metap)
library(pwr)
library(lsr)
#install.packages("sjstats")
library(sjstats)
library(DescTools)
#inatall.packages("ggstatsplot")
#library(ggstatsplot)
library(VGAM)
library(nnet)
library(mlogit)
library(reshape2)
#install.packages("powerMediation")
library("powerMediation")

```

# Combined Analyses


```{r ch5setupcombineddata}
getwd()
rm(list=ls())
load("../loaded_data/one.RData")
load("../loaded_data/two.RData")
load("../loaded_data/three.RData")
load("../loaded_data/four.RData")
load("../loaded_data/five.RData")
load("../loaded_data/six.RData")
load("../loaded_data/combined.RData")



```


```{r ch5allpreptable}
rbind(table(engaged0_2_3a$InCS,engaged0_2_3a$condition),
      table(engaged0_2_3b$InCS,engaged0_2_3b$condition))


make4table1 <- function(){
  
  tb_count_perc <- function(x){
  tc <- table(x$InCS,x$condition)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$condition=="cog_load")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$condition=="control")*100),"%"))
}

  
  rows <- c("Reasons","Dumbfounded","Nothing wrong")
  
  t0 <- tb_count_perc(college)
  t1 <- tb_count_perc(one)
  t2 <- tb_count_perc(two)
  t3 <- tb_count_perc(three)
  t5 <- tb_count_perc(study5)
  t6 <- tb_count_perc(df6)
  t23 <- tb_count_perc(two_three)
  t23e7 <- tb_count_perc(engaged0_2_3a)
  t23e8 <- tb_count_perc(engaged0_2_3b)
  t023 <- tb_count_perc(zero_two_three)
  t0123 <- tb_count_perc(zero_one_two_three)
  t01235 <- tb_count_perc(zero_one_two_three_five)
  t012356 <- tb_count_perc(zero_one_two_three_five_six)


  
  c("Study 1"," "," ",
                 "Study 2"," "," ",
                 "Study 3"," "," ",
                 "Study 4"," "," ",
                 "Study 5"," "," ",
                 "Study 6"," "," ",
                 "Studies 3 and 4"," "," ",
                 "Studies 3 and 4 engaged 1"," "," ",
                 "Studies 3 and 4 engaged 2"," "," ",
                 "Studies 1, 3, and 4"," "," ",
                 "Studies 1, 2, 3, and 4"," "," ")
  rbind(t0,t1,t2,t3,t5,t6,t23,t23e7,t23e8,t023,t012356)
  
  rows_left <- c("Study 1"," "," ",
                 "Study 2"," "," ",
                 "Study 3"," "," ",
                 "Study 4"," "," ",
                 "Study 5"," "," ",
                 "Study 6"," "," ",
                 "Studies 3 and 4"," "," ",
                 "Studies 3 and 4 engaged 1"," "," ",
                 "Studies 3 and 4 engaged 2"," "," ",
                 "Studies 1, 3, and 4"," "," ",
                 "Studies 1, 2, 3, and 4"," "," ")
  
  
  test1 <- cbind(c("Study 1*"," "," ",
                       "Study 2"," "," ",
                       "Study 3*"," "," ",
                       "Study 4"," "," ",
                       "Study 5"," "," ",
                       "Study 6"," "," ",    
                       "All Studies*"," "," "),
                     rows,
                     unname(rbind(t0,t1,t2,t3,t5,t6,t012356)))
  
  cols <- c("Study","Response","N","percent","N","percent")
  test1 <- `colnames<-`(test1, cols)
  
  test1
  
}

make4table1()

make4table2 <- function(){
  
  tb_count_perc <- function(x){
  tc <- table(x$InCS,x$condition)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$condition=="cog_load")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$condition=="control")*100),"%"))
  }
  
  tb_count_perc_eng <- function(x){
  tc <- table(x$InCS,x$engaged)
  cbind(tc[,1],paste0(round(tc[,1]/sum(x$engaged=="engaged")*100),"%"),
        tc[,2],paste0(round(tc[,2]/sum(x$engaged=="not engaged")*100),"%"))
  }
  
  one$study <- rep("one",length(one$gender))
  one_e <- cbind.data.frame(one$engaged, one$InCS, one$cog_load_CS_num, one$NFC, one$reason_always, one$changed,one$gender, one$Ju1_bin, one$Ju2_bin,one$right_change, one$study)
colnames(one_e) <- c("condition","InCS","cog_load_CS_num","NFC","reason_always","changed","gender","Ju1_bin","Ju2_bin","right_change", "study")
  one_e$condition <- car::recode(one_e$condition, "'engaged'='cog_load';'not engaged'='control'")
  eng_0123a <- rbind(engaged0_2_3a,one_e,df5,df6)
  eng_0123b <- rbind(engaged0_2_3b,one_e,df5,df6)
  
  rows <- c("Reasons","Dumbfounded","Nothing wrong")
  
  t0 <- tb_count_perc(college)
  t1 <- tb_count_perc_eng(one)
  df3 <- two
  df3 <- df3[which(df3$engaged==TRUE),]
  t2 <- tb_count_perc(df3)
  df3 <- three
  df3 <- df3[which(df3$engaged==TRUE),]
  t3 <- tb_count_perc(df3)
  t5 <- tb_count_perc(study5)
  t6 <- tb_count_perc(df6)
  t0123a <- tb_count_perc(eng_0123a)
  t0123b <- tb_count_perc(eng_0123b)
  t023 <- tb_count_perc(zero_two_three)
  t0123 <- tb_count_perc(zero_one_two_three)
  
  
  
  rbind(t0,t1,t2,t3,t5,t6,t0123a)#,t0123b)
  
  rows_left <- c("Study 1"," "," ",
                 "Study 2"," "," ",
                 "Study 3"," "," ",
                 "Study 4"," "," ",
                 "Study 5"," "," ",
                 "Studies 3 and 4"," "," ",
                 "Studies 3 and 4 engaged 1"," "," ",
                 "Studies 3 and 4 engaged 2"," "," ",
                 "Studies 1, 3, and 4"," "," ",
                 "Studies 1, 2, 3, and 4"," "," ")
  
  
  test1 <- cbind(c("Study 1*"," "," ",
                 "Study 2 (engaged)*"," "," ",
                 "Study 3 (engaged)**"," "," ",
                 "Study 4 (engaged)"," "," ",
                 "Study 5"," "," ",
                 "Study 6"," "," ",
                 "All studies (engaged)**"," "," "#,
                 #"All studies (engaged b)**"," "," "
                 ),
                 rows,
                     unname(rbind(t0,t1,t2,t3,t5,t6,t0123a
                                  #,t0123b
                                  )))
  
  cols <- c("Study","Response","N","percent","N","percent")
  test1 <- `colnames<-`(test1, cols)
  
  test1
  
}

make4table2()

test1 <- make4table1()
test2 <- make4table2()



makespanners <- function(){
  cog_load <- c(3,4)
  control <- c(5,6)
  spans <- list(cog_load,control)
  names(spans) <- c("Cognitive Load","Control")
  spans
}

rm(make4table1,make4table2)

```


```{r ch5taballraw,results = 'asis', include=FALSE}
#setwd("Chapter_3")

apa_table(
   test1
   , align = c("l", "l", "c", "c", "c", "c")
   , caption = "Responses to critical slide for all cognitive load studies (raw)"
   #, added_stub_head = "Response to critical slide"
   , note = "*significant variation at \\emph{p} < .05; **significant variation at \\emph{p} < .001"
   , col_spanners = makespanners()
   , small = TRUE
   , escape = FALSE
   
)

#rm(test1)

```

```{r ch5taballeng,results = 'asis', include=FALSE}
#setwd("Chapter_3")

apa_table(
   test2
   , align = c("l", "l", "c", "c", "c", "c")
   , caption = "Responses to critical slide for all cognitive load studies (controlling for engagement)"
   #, added_stub_head = "Response to critical slide"
   , note = "*significant variation at \\emph{p} < .05; **significant variation at \\emph{p} < .001"
   , col_spanners = makespanners()
   , small = TRUE
   , escape = FALSE
   
)

rm(makespanners,test2)

```



```{r combinednoengagement}
df3 <- zero_one_two_three_five_six
c <- chisq.test(table(df3$InCS,df3$condition))
w <- sqrt(c[]$statistic/length(df3$gender))
pw <- pwr.chisq.test(w=w,N=length(df3$InCS),df=(3-1),sig.level = .05)

# The total raw responses (without accounting for engagement with the memory task) for each option on the critical slide depending on experimental condition for each study and all studies combined are shown in Table\ \@ref(tab:Salltab1dumb).  Taking the combined raw data for each condition across all 6 studies, without accounting for engagement with the memory task, a significant association between cognitive load and responses to the critical slide was found, $\chi$^2^(`r c$parameter`, *N* = `r length(df3$Ju1_bin)`) = `r round(c$statistic, digits=3)`, *p* `r paste(p_report(c$p.value))`, *V* = `r w`, the observed power was `r pw$power`. 

```






```{r combinedandmeta1}

df3 <- eng_0123a
c <- chisq.test(table(df3$InCS,df3$condition))
w <- sqrt(c[]$statistic/length(df3$gender))
pw <- pwr.chisq.test(w=w,N=length(df3$InCS),df=(3-1),sig.level = .05)
c



table_values(c(88,83,177),c(63,53,196))
length(df3$Ju1_bin)

```

The combined results for Studies 1-6 are displayed in Figures\ \@ref(fig:ch5Sallfig2criticalcondition) and \ \@ref(fig:ch5figall). When engagement with the memory task was accounted for (*N* = `r length(df3$Ju1_bin)`; `r sum(df3$condition=="cog_load")` experimental, `r sum(df3$condition=="control")` control), a significant association between cognitive load and responses to the critical slide was found, $\chi$^2^(`r c$parameter`, *N* = `r length(df3$Ju1_bin)`) = `r round(c$statistic, digits=3)`, *p* `r paste(p_report(c$p.value))`, *V* = `r w`, the observed power was `r pw$power`.  The observed counts, expected counts, and standardised residuals are displayed in Table\ \@ref(tab:Salltab1dumb).


```{r combinedandmeta2}

df3 <- eng_0123a
c <- chisq.test(table(df3$InCS,df3$condition))
w <- sqrt(c[]$statistic/length(df3$gender))
pw <- pwr.chisq.test(w=w,N=length(df3$InCS),df=(3-1),sig.level = .05)

meta1 <- sumlog(c(.023,.021,.039,.359))

psch5 <- c(.023,.021,.039,.359)
wtsch5 <- sqrt(c(66,100,129,127))


psch5 <- c(.023,.021,.039,.359,.000002925)
wtsch5 <- sqrt(c(66,100,129,127, 1686))

meta2 <- sumz(psch5,wtsch5)


meta3 <- sumlog(c(.023,.021,.039,.359,.215,.000002925))
meta3
#psch5 <- c(.023,.021,.039,.359,.215)
#wtsch5 <- sqrt(c(66,100,129,127,204))

meta4 <- sumz(psch5,wtsch5)
meta4


```

```{r}
df3 <- eng_0123a
df3$condition
glm_model<-lme4::glmer(InCS ~ condition + (1 | study),
                   data = df3
                   #reflevel = "It's wrong and I can provide a valid reason."
                   ,family="binomial")
#)
df3a <- mlogit.data(df3, choice = "InCS", shape = "wide")
InCSModel<-mlogit(InCS ~ 1 | condition+study,
                  data = df3a,
                  reflevel = "It's wrong and I can provide a valid reason."
                  )


summary(InCSModel)
df3$study
```

\newpage



```{r preptableSall}

df3 <- eng_0123a

c <- chisq.test(table(df3$InCS,df3$condition))
rownames(rbind(c$observed,c$expected,c$stdres))



ps <- function(y){
  if(as.numeric(sqrt( y*y) ) >3.3) print(paste0(y,"**"), quote = FALSE)
  else if(as.numeric(sqrt( y*y) ) >1.96) print(paste0(y,"*"), quote = FALSE)
  else print(y)}


x <- c$stdres
x <- round(x, digits = 2)

lapply(x, ps)

#c$stdres <- round(c$stdres,digits=3)
#c$stdres <- ps(c$stdres)

ps(x[1])
ps(x[2])
ps(x[3])

x <- `colnames<-`(
  cbind.data.frame(c(ps(x[1]),ps(x[2]),ps(x[3])),
                   c(ps(x[4]),ps(x[5]),ps(x[6]))),
  c("cog_load","control")
)

rownames(x) <- row.names(c$observed)  
c$expected


y <- rbind(round(c$observed), round(c$expected, digits = 2))

c(c$stdres[1])

y
res <- cbind(c("Observed count","","","Expected count","","","Standardised residuals","",""),
      c("Reasons","Dumbfounded","Nothing Wrong",
        "Reasons","Dumbfounded","Nothing Wrong",
        "Reasons","Dumbfounded","Nothing Wrong"),
      rbind(y,x)
      
      )

row.names(res) <- NULL
colnames(res) <- c("","","Cognitive Load","Control")




```

```{r Salltab1dumb,results = 'asis', include=TRUE}


apa_table(
   res
   , align = c("l", "l", "c", "c", "c")
   , caption = "Studies 1-6 – Observed counts, expected counts, and standardised residuals for each response depending on cognitive load"
   #, added_stub_head = "Response to critical slide"
   #, col_spanners = makespanners()
   , note = "* = sig. at \\emph{p} < .05; ** = sig. at \\emph{p} < .001"
   , escape = FALSE
   
)

```



A mini meta-analysis was conducted and found that cognitive load significantly influenced responding across all studies  $\chi$^2^(`r meta3$df`) = `r round(meta3$chisq, digits=3)`, *p* `r paste(p_report(meta3$p))` (Fisher’s method); or when weighting for sample size, *z* `r paste(p_report(meta4$z))`, *p* `r paste(p_report(meta4$p))` (Stouffer's Z-score method).




```{r prepch5S4allfig2}
#df3 <- df3[which(df3$cog_load_CS_num>6|df3$condition=="control"),]
df3 <- eng_0123a
table(df3$condition)
y <- table(df3$InCS,df3$condition)
y <- as.data.frame(y)
#colnames(y) <- c("condition","InCS","Freq")
colnames(y) <- c("InCS","condition","Freq")

z <- as.data.frame(table(df3$condition,df3$InCS)/length(df3$gender)*2)

z <- rbind(as.data.frame(table(df3$InCS[which(df3$condition=="cog_load")])/
                           length(df3$InCS[which(df3$condition=="cog_load")])),
           as.data.frame(table(df3$InCS[which(df3$condition=="control")])/
                           length(df3$InCS[which(df3$condition=="control")])))


perc <- z$Freq
test <- cbind(y,perc)

# z <- as.data.frame(table(df3$condition,df3$Dumb_incl_string)/length(df3$gender)*2)
# perc <- z$Freq
# test <- cbind(y,perc)
# test$condition
# test

ab_graph <- function(){
  a <- df3[which(df3$condition==levels(as.factor(df3$condition))[1]),]
  b <- df3[which(df3$condition==levels(as.factor(df3$condition))[2]),]
  a#levels(as.factor(df3$condition))[1]
  
  ay <- as.data.frame(table(a$InCS,as.character(a$condition)))
  by <- as.data.frame(table(b$InCS,as.character(b$condition)))
  
  aperc <- ay$Freq/length(a$gender)
  ay <- cbind(ay,aperc)
  colnames(ay) <- c("InCS","condition","Freq","perc")
  
  bperc <- by$Freq/length(b$gender)
  by <- cbind(by,bperc)
  colnames(by) <- c("InCS","condition","Freq","perc")
  
  c <- rbind(ay,by)
  
  c
}

test <- ab_graph()
table(df3$condition)

#rm(x,y)
```

```{r ch5Sallfig2criticalcondition, fig.cap="Studies 1-6: Responses to critical slide for the cognitive load groups (*N* = 1,145) and the control groups (*N* = 1,167) controlling for engagement", include=TRUE}



ggplot(test, aes(x=reorder(InCS), y=perc, fill=factor(condition,labels=c("Cognitive load","Control")))) +
  scale_y_continuous(limits = c(-.03,1),
                     labels = percent_format()
  )+ 
  geom_col(position = "dodge",
           color="black",
           size=.2
  )+
  geom_text(#family = "Times",
            size=4.2,
            aes( label = scales::percent(perc, accuracy = 1),
                 y= perc ),
            stat= "identity",
            vjust = -.5,
            position = position_dodge(.9),
            fontface='plain'
            )+
  geom_text(#family = "Times",
            size=4.2,
            aes(label = format(Freq),
                y= -3*(..count../100)/(..count..)),
            stat= "count",
            position = position_dodge(0.9),
            #vjust = -.05,
            fontface='plain'
            ) +
  xlab("Response to Critical Slide") +
  ylab("Percentage of participants selecting each response")+
  scale_x_discrete(labels=c("Reasons", "Dumbfounded","Nothing Wrong")) +
  scale_fill_grey(start = .5, end = .8) +
  labs(fill="Condition") +
  #theme_apa() +
  theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(size = .2),
        strip.background  = element_blank(),
        panel.grid = element_blank(),
        plot.title=element_text(#family="Times",
          size=12
        ),
        legend.text=element_text(#family="Times",
          size=8
        ),
        legend.title=element_text(#family="Times",
          size=10
        ),
        axis.text=element_text(#family="Times",
          colour = "black",
          size=8
        ),
        axis.ticks.x = element_blank(),
        axis.title=element_text(#family="Times",
          size=12
        ),
        strip.text=element_text(#family = "Times",
          size = 12
        ),
        #strip.background = element_rect(fill = "white"),
        legend.position="right")




#rm(a,b,c)
# 
# g <- ggplot(df3, aes(x=InCS, fill=factor(condition,labels=c("Cognitive load","Control"))))
# g <- g + geom_bar(aes(y=..count..), position = position_dodge(), color="black")
# g <- g + xlab("Response to critical slide")
# #g <- g + ggtitle("Dumbfounding and Cognitive load")
# g <- g + scale_x_discrete(labels=c("nothing wrong", "no reason", "valid reason"))
# g <- g + scale_fill_grey(start = .5, end = .8)+ theme_bw()
# g <- g + labs(fill="Condition") 
# #grid.gedit("GRID.text",gp=gpar(fontfamily="serif"))
# g <- g + geom_text(family = "Times", aes(label = format(..count..),y= ..count.. ), stat= "count", vjust = 1.6, position = position_dodge(0.9))
# 
# g + theme(plot.title=element_text(family="Times", size=12), legend.text=element_text(family="Times", size=8), legend.title=element_text(family="Times", size=12), axis.text=element_text(family="Times", size=8), axis.title=element_text(family="Times", size=12))
# rm(g)

```

```{r ch5prepfigall}
#make4graph <- function(){
  
  tb_count_perc <- function(x){
  tc <- table(x$InCS,x$condition)
  cbind(tc[,1],((tc[,1]/sum(x$condition=="cog_load"))),
        tc[,2],((tc[,2]/sum(x$condition=="control"))))
  }
  
  tb_count_perc_eng <- function(x){
  tc <- table(x$InCS,x$engaged)
  cbind(tc[,1],((tc[,1]/sum(x$engaged=="engaged"))),
        tc[,2],((tc[,2]/sum(x$engaged=="not engaged"))))
  }
  
  
  one$study <- rep("one",length(one$gender))
  one_e <- cbind.data.frame(one$engaged, one$InCS, one$cog_load_CS_num, one$NFC, one$reason_always, one$changed,one$gender, one$Ju1_bin, one$Ju2_bin,one$right_change, one$study)
colnames(one_e) <- c("condition","InCS","cog_load_CS_num","NFC","reason_always","changed","gender","Ju1_bin","Ju2_bin","right_change","study")
  one_e$condition <- car::recode(one_e$condition, "'engaged'='cog_load';'not engaged'='control'")
  eng_0123a <- rbind(engaged0_2_3a,one_e,df5,df6)
  eng_0123b <- rbind(engaged0_2_3b,one_e,df5,df6)
  
  rows <- c("Reasons","Dumbfounded","Nothing wrong")
  
  t0 <- tb_count_perc(college)
  t1 <- tb_count_perc_eng(one)
  df3 <- two
  df3 <- df3[which(df3$engaged==TRUE),]
  t2 <- tb_count_perc(df3)
  df3 <- three
  df3 <- df3[which(df3$engaged==TRUE),]
  t3 <- tb_count_perc(df3)
  t5 <- tb_count_perc(study5)
  t6 <- tb_count_perc(df6)
  t0123a <- tb_count_perc(eng_0123a)
  t0123b <- tb_count_perc(eng_0123b)
  t023 <- tb_count_perc(zero_two_three)
  t0123 <- tb_count_perc(zero_one_two_three)
  
  
  
  rbind(t0,t1,t2,t3,t5,t6,t0123a#,t0123b
        )
  
  rows_left <- c("Study 1"," "," ",
                 "Study 2"," "," ",
                 "Study 3"," "," ",
                 "Study 4"," "," ",
                 "Study 5"," "," ",
                 "Study 6"," "," ",
                 "Studies 3 and 4"," "," ",
                 "Studies 3 and 4 engaged 1"," "," ",
                 "Studies 3 and 4 engaged 2"," "," ",
                 "Studies 1, 3, and 4"," "," ",
                 "Studies 1, 2, 3, and 4"," "," ")
  
  
  test1 <- cbind(c("1Study 1","1Study 1","1Study 1",
                 "2Study 2","2Study 2","2Study 2",
                 "3Study 3","3Study 3","3Study 3",
                 "4Study 4","4Study 4","4Study 4",
                 "5Study 5","5Study 5","5Study 5",
                 "6Study 6","6Study 6","6Study 6",
                 "7All studies engaged 1","7All studies engaged 1","7All studies engaged 1"#,
                 #"8All studies engaged 2","8All studies engaged 2","8All studies engaged 2"
                 ),
                 rows,
                     unname(rbind(t0,t1,t2,t3,t5,t6,t0123a#,t0123b
                                  )))
  
  cols <- c("Study","Response","N","percent","N","percent")
  test1 <- `colnames<-`(test1, cols)
  
  test1
  
  test1 <- as.data.frame(test1)
  test1 <- test1[which(test1$Response=="Reasons"),]
  
  c((test1[3]),(test1[5]))
  
  c(rep("cog_load",length=7),rep("control",length=7))
  
  test1 <- cbind(rbind(test1[1:2],test1[1:2]),
                 rbind(test1[3:4],test1[5:6]),
                 c(rep("cog_load",length=7),rep("control",length=7)))
  
  colnames(test1) <- c("Study","Response","N","percent","condition")
  test1$N <- as.numeric(as.character(test1$N))
  test1$percent <- as.numeric(as.character(test1$percent))
  test1
  
#}
test <- test1 # make4graph()
#rm(make4graph)

sum(test$N)-772
```



```{r ch5prepfigalldumb1}
#make4graph <- function(){
  
  tb_count_perc <- function(x){
  tc <- table(x$InCS,x$condition)
  cbind(tc[,1],((tc[,1]/sum(x$condition=="cog_load"))),
        tc[,2],((tc[,2]/sum(x$condition=="control"))))
  }
  
  tb_count_perc_eng <- function(x){
  tc <- table(x$InCS,x$engaged)
  cbind(tc[,1],((tc[,1]/sum(x$engaged=="engaged"))),
        tc[,2],((tc[,2]/sum(x$engaged=="not engaged"))))
  }
  
  
  one$study <- rep("one",length(one$gender))
  one_e <- cbind.data.frame(one$engaged, one$InCS, one$cog_load_CS_num, one$NFC, one$reason_always, one$changed,one$gender, one$Ju1_bin, one$Ju2_bin,one$right_change, one$study)
colnames(one_e) <- c("condition","InCS","cog_load_CS_num","NFC","reason_always","changed","gender","Ju1_bin","Ju2_bin","right_change","study")
  one_e$condition <- car::recode(one_e$condition, "'engaged'='cog_load';'not engaged'='control'")
  eng_0123a <- rbind(engaged0_2_3a,one_e,df5,df6)
  eng_0123b <- rbind(engaged0_2_3b,one_e,df5,df6)
  
  rows <- c("Nothing wrong","Dumbfounded","Reasons")
  
  t0 <- tb_count_perc(college)
  t1 <- tb_count_perc_eng(one)
  df3 <- two
  df3 <- df3[which(df3$engaged==TRUE),]
  t2 <- tb_count_perc(df3)
  df3 <- three
  df3 <- df3[which(df3$engaged==TRUE),]
  t3 <- tb_count_perc(df3)
  t5 <- tb_count_perc(study5)
  t6 <- tb_count_perc(df6)
  t0123a <- tb_count_perc(eng_0123a)
  t0123b <- tb_count_perc(eng_0123b)
  t023 <- tb_count_perc(zero_two_three)
  t0123 <- tb_count_perc(zero_one_two_three)
  
  
  
  rbind(t0,t1,t2,t3,t5,t6,t0123a,t0123b)
  
  rows_left <- c("Study 1"," "," ",
                 "Study 2"," "," ",
                 "Study 3"," "," ",
                 "Study 4"," "," ",
                 "Study 5"," "," ",
                 "Study 6"," "," ",
                 "Studies 3 and 4"," "," ",
                 "Studies 3 and 4 engaged 1"," "," ",
                 "Studies 3 and 4 engaged 2"," "," ",
                 "Studies 1, 3, and 4"," "," ",
                 "Studies 1, 2, 3, and 4"," "," ")
  
  
  test1 <- cbind(c("1Study 1","1Study 1","1Study 1",
                 "2Study 2","2Study 2","2Study 2",
                 "3Study 3","3Study 3","3Study 3",
                 "4Study 4","4Study 4","4Study 4",
                 "5Study 5","5Study 5","5Study 5",
                 "6Study 6","6Study 6","6Study 6",
                 "7All studies engaged 1","7All studies engaged 1","7All studies engaged 1",
                 "8All studies engaged 2","8All studies engaged 2","8All studies engaged 2"),
                 rows,
                     unname(rbind(t0,t1,t2,t3,t5,t6,t0123a,t0123b)))
  
  cols <- c("Study","Response","N","percent","N","percent")
  test1 <- `colnames<-`(test1, cols)
  
  test1
  
  test1 <- as.data.frame(test1)
  test1 <- test1[which(test1$Response=="Dumbfounded"),]
  
  c((test1[3]),(test1[5]))
  
  c(rep("cog_load",length=7),rep("control",length=7))
  
  test1 <- cbind(rbind(test1[1:2],test1[1:2]),
                 rbind(test1[3:4],test1[5:6]),
                 c(rep("cog_load",length=8),rep("control",length=8)))
  
  colnames(test1) <- c("Study","Response","N","percent","condition")
  test1$N <- as.numeric(as.character(test1$N))
  test1$percent <- as.numeric(as.character(test1$percent))
  test1
  
#}
#test <- test1 # make4graph()
#rm(make4graph)


```

\newpage


```{r ch5figall, fig.cap="Rates of declaring reasons and cognitive load across each study", include=TRUE}

ggplot(test, aes(x = Study, y = percent, fill = factor(condition,labels = c("Cognitive\nLoad","Control")))) +
  scale_y_continuous(limits = c(-.035,1),
                     labels = percent_format()
                     )+ 
  geom_col(position = "dodge",
           color="black",
           size=.2
           )+
  geom_text(#family = "Times",
            size=2.3,
            aes( label = scales::percent(percent,accuracy = 1),
                 y= percent ),
            stat= "identity",
            vjust = -.5,
            position = position_dodge(.9),
            fontface='plain'
            )+
  geom_text(#family = "Times",
            size=2.5,
            aes(label = format(N),
                y= -3.4*(..count../100)/..count..),
            stat= "count",
            position = position_dodge(0.9),
            vjust = -.21,
            fontface='plain'
            )+
  labs(y = "% of participants providing reasons for their judgements",
       fill = ""
       )+
  scale_fill_grey(start = .5, end = .8) +
  theme_apa()+
  # scale_fill_manual(values = c("#333333", "#989898", "#B4B4B4", "#E6E6E6"),
  #                   labels=c("Study 1\nN=31",
  #                          "Study 2\nN=72",
  #                          "Study 3a\nN=72",
  #                          "Study 3b\nN=101"))+
  # scale_fill_grey(labels=c("Study 1\nN=66",
  #                          "Study 2 a\nN=100",
  #                          "Study 3 a\nN=129",
  #                          "Study 4 a\nN=127",
  #                          "Study 5 \nN=204",
  #                          "All studies a\nN=626",
  #                          "All studies b\nN=617")
  #                 )+
  scale_x_discrete(labels=c("Study 1\nN=66",
                           "Study 2\nN=100",
                           "Study 3\nN=129",
                           "Study 4\nN=127",
                           "Study 5\nN=204",
                           "Study 6\nN=1686",
                           "All Studies\nN=2312"#,
                           #"All 'b'\nN=2303"
                           )
                  )+
  # scale_fill_brewer(palette="OrRd") +
  # scale_fill_discrete(labels=c("Study 1\nN=66",
  #                          "Study 2 a\nN=100",
  #                          "Study 3 a\nN=129",
  #                          "Study 4 a\nN=127",
  #                          "Study 5 \nN=204",
  #                          "All studies a\nN=626",
  #                          "All studies b\nN=617")
  #                 )+
  # scale_x_discrete(labels = c("Load/Engaged","Control")
  #                  )+
  #scale_fill_grey(labels = c("Load/Engaged","Control"))+
  theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(size = .2),
        strip.background  = element_blank(),
        panel.grid = element_blank(),
        plot.title=element_text(#family="Times",
          size=12
        ),
        legend.text=element_text(#family="Times",
          size=8
        ),
        legend.title=element_text(#family="Times",
          size=8
        ),
        axis.text=element_text(#family="Times",
          colour = "black",
          size=8
        ),
        axis.ticks.x = element_blank(),
        axis.title=element_text(#family="Times",
          size=12
        ),
        strip.text=element_text(#family = "Times",
          size = 12
        ),
        #strip.background = element_rect(fill = "white"),
        legend.position="right",
        legend.key.size = unit(1.5, "lines"))

rm(test)


```


```{r ch5prepfigallnocombined}
make4graph <- function(){
  
  tb_count_perc <- function(x){
  tc <- table(x$InCS,x$condition)
  cbind(tc[,1],((tc[,1]/sum(x$condition=="cog_load"))),
        tc[,2],((tc[,2]/sum(x$condition=="control"))))
  }
  
  tb_count_perc_eng <- function(x){
  tc <- table(x$InCS,x$engaged)
  cbind(tc[,1],((tc[,1]/sum(x$engaged=="engaged"))),
        tc[,2],((tc[,2]/sum(x$engaged=="not engaged"))))
  }
  
  
  one$study <- rep("on2",length(one$gender))
  one_e <- cbind.data.frame(one$engaged, one$InCS, one$cog_load_CS_num, one$NFC, one$reason_always, one$changed,one$gender, one$Ju1_bin, one$Ju2_bin,one$right_change,one$study)
colnames(one_e) <- c("condition","InCS","cog_load_CS_num","NFC","reason_always","changed","gender","Ju1_bin","Ju2_bin","right_change","study")
  one_e$condition <- car::recode(one_e$condition, "'engaged'='cog_load';'not engaged'='control'")
  eng_0123a <- rbind(engaged0_2_3a,one_e,df5,df6)
  eng_0123b <- rbind(engaged0_2_3b,one_e,df5,df6)
  
  rows <- c("Nothing wrong","Dumbfounded","Reasons")
  
  t0 <- tb_count_perc(college)
  t1 <- tb_count_perc_eng(one)
  df3 <- two
  df3 <- df3[which(df3$engaged==TRUE),]
  t2 <- tb_count_perc(df3)
  df3 <- three
  df3 <- df3[which(df3$engaged==TRUE),]
  t3 <- tb_count_perc(df3)
  t5 <- tb_count_perc(study5)
  t0123a <- tb_count_perc(eng_0123a)
  t0123b <- tb_count_perc(eng_0123b)
  t023 <- tb_count_perc(zero_two_three)
  t0123 <- tb_count_perc(zero_one_two_three)
  
  
  
  rbind(t0,t1,t2,t3,t5,t0123a,t0123b)
  
  rows_left <- c("Study 1"," "," "
                 ,"Study 2"," "," "
                 ,"Study 3"," "," "
                 ,"Study 4"," "," "
                 ,"Study 5"," "," "
                 ,"Studies 3 and 4"," "," "
                 ,"Studies 3 and 4 engaged 1"," "," "
                 ,"Studies 3 and 4 engaged 2"," "," "
                 ,"Studies 1, 3, and 4"," "," "
                 ,"Studies 1, 2, 3, and 4"," "," "
                 )
  
  
  test1 <- cbind(c("1Study 6","1Study 6","1Study 6"
                   ,"2Study 7","2Study 7","2Study 7"
                   ,"3Study 8","3Study 8","3Study 8"
                   ,"4Study 9","4Study 9","4Study 9"
                   ,"5Study 5","5Study 5","5Study 5"
                   #,"6All studies engaged 1","6All studies engaged 1","6All studies engaged 1"
                   #,"7All studies engaged 2","7All studies engaged 2","7All studies engaged 2"
                   ),
                 rows,
                     unname(rbind(
                       t0
                       ,t1
                       ,t2
                       ,t3
                       ,t5
                       #,t0123a
                       #,t0123b
                       )))
  
  cols <- c("Study","Response","N","percent","N","percent")
  test1 <- `colnames<-`(test1, cols)
  
  test1
  
  test1 <- as.data.frame(test1)
  test1 <- test1[which(test1$Response=="Reasons"),]
  
  c((test1[3]),(test1[5]))
  
  c(rep("cog_load",length=6),rep("control",length=6))
  
  test1 <- cbind(rbind(test1[1:2],test1[1:2]),
                 rbind(test1[3:4],test1[5:6]),
                 c(rep("cog_load",length=5),rep("control",length=5)))
  
  colnames(test1) <- c("Study","Response","N","percent","condition")
  test1$N <- as.numeric(as.character(test1$N))
  test1$percent <- as.numeric(as.character(test1$percent))
  test1
  
}
test <- make4graph()
rm(make4graph)

```

```{r ch5figallnocombined, fig.cap="Rates of declaring reasons and cognitive load across each study", include=FALSE}

ggplot(test, aes(x = Study, y = percent, fill = condition)) +
  scale_y_continuous(limits = c(-.03,1),
                     labels = percent_format()
                     )+ 
  geom_col(position = "dodge",
           color="black",
           size=.2
           )+
  geom_text(family = "Times", size=2.3,
            aes( label = scales::percent(test$percent),
                 y= test$percent ),
            stat= "identity",
            vjust = -.5,
            position = position_dodge(.9),
            fontface='plain'
            )+
  geom_text(family = "Times", size=2.5,
            aes(label = format(N),
                y= -3*(..count../100)/..count..),
            stat= "count",
            position = position_dodge(0.9),
            vjust = -.2,
            fontface='plain'
            )+
  labs(y = "% of participants providing\n reasons for their judgements",
       fil = ""
       )+
  theme_apa()+
  # scale_fill_manual(values = c("#333333", "#989898", "#B4B4B4", "#E6E6E6"),
  #                   labels=c("Study 1\nN=31",
  #                          "Study 2\nN=72",
  #                          "Study 3a\nN=72",
  #                          "Study 3b\nN=101"))+
  # scale_fill_grey(labels=c("Study 1\nN=66",
  #                          "Study 2 a\nN=100",
  #                          "Study 3 a\nN=129",
  #                          "Study 4 a\nN=127",
  #                          "Study 5 \nN=204",
  #                          "All studies a\nN=626",
  #                          "All studies b\nN=617")
  #                 )+
  scale_x_discrete(labels=c("Study 1\nN=66"
                            ,"Study 2 a\nN=100"
                            ,"Study 3 a\nN=129"
                            ,"Study 4 a\nN=127"
                            ,"Study 5 \nN=204"
                            #,"All studies a\nN=626"
                            #,"All studies b\nN=617"
                            )
                  )+
  # scale_fill_brewer(palette="OrRd") +
  # scale_fill_discrete(labels=c("Study 1\nN=66",
  #                          "Study 2 a\nN=100",
  #                          "Study 3 a\nN=129",
  #                          "Study 4 a\nN=127",
  #                          "Study 5 \nN=204",
  #                          "All studies a\nN=626",
  #                          "All studies b\nN=617")
  #                 )+
  # scale_x_discrete(labels = c("Load/Engaged","Control")
  #                  )+
  scale_fill_grey(labels = c("Load/Engaged","Control")
                   )+
  theme_bw() +
  theme(plot.title=element_text(family="Times",
                                size=12
                                ),
        legend.text=element_text(family="Times",
                                 size=8
                                 ),
          legend.title=element_text(family="Times",
                                    size=10
                                    ),
          axis.text=element_text(family="Times",
                                 colour = "black",
                                 size=8
                                 ),
          axis.ticks.x = element_blank(),
          axis.title=element_text(family="Times",
                                  size=12
                                  ),
          strip.text=element_text(family = "Times",
                                  size = 12
                                  ),
          strip.background = element_rect(fill = "white"),
          legend.position="right",
        legend.key.size = unit(1.5, "lines"))

rm(test)


```


```{r logit}
# df3 <- zero_one_two_three
# df3 <- zero_one_two_three_five
# df3 <- three

df3 <- zero_one_two_three_five

#df3$InCS <- relevel(df3$InCS, ref = 2)

df3a <- mlogit.data(df3, choice = "InCS", shape = "wide")
#InCSModel<-mlogit(InCS ~ 1 | NFC + condition, data = df3a, reflevel = 2)
InCSModel<-mlogit(InCS ~ 1 | NFC, data = df3a, reflevel = "It's wrong but I can't think of a reason.")

#InCSModel<-mlogit(InCS ~ 1 | NFC*condition, data = df3a, reflevel = "It's wrong and I can provide a valid reason.")
#summary(aov(NFC~condition*InCS, data=df3))

summary_InCS_model <- summary(InCSModel)
summary_InCS_model$lratio$parameter
summary_InCS_model$lratio$statistic
summary_InCS_model$lratio$p.value

InCSModel$coefficients[3]
InCSModel$coefficients[4]

cox <- PseudoR2(multinom(InCS~NFC,df3), "all")

cox[3]
cox[4]
#PseudoR2(x, "all")
summary_InCS_model
summary_InCS_model$CoefTable

wald1 <- 
  summary_InCS_model$CoefTable[3]^2 /
  summary_InCS_model$CoefTable[7]^2

wald2 <- 
  summary_InCS_model$CoefTable[4]^2 /
  summary_InCS_model$CoefTable[8]^2


summary_InCS_model
summary_InCS_model$coefficients[3]
data.frame(exp(InCSModel$coefficients))

exp(InCSModel$coefficients)[3]
exp(InCSModel$coefficients)


a <- exp(confint(InCSModel))
a
c(a[3],a[7])

residuals(InCSModel)
fitted(InCSModel, outcome = F)

c <- summary_InCS_model$lratio$statistic
w <- sqrt(c/length(df3$gender))
pw <- pwr.chisq.test(w=w,N=length(df3$InCS),df=(2),sig.level = .05)

pw$power


revised_PseudoR2s <- function(LogModel) {
  dev <- LogModel$deviance
  nullDev <- LogModel$null.deviance
  modelN <- length(LogModel$fitted.values)
  R.l <- 1 - dev / nullDev
  R.cs <- 1- exp ( -(nullDev - dev) / modelN)
  R.n <- R.cs / ( 1 - ( exp (-(nullDev / modelN))))
  
  all <- list(hosmer_and_lemeshow = as.numeric(R.l), mcfadden = NA, cox_and_snell = as.numeric(R.cs), nagelkerke = as.numeric(R.n))
  all
}

logits_rsquared <- glm(InCS~NFC+condition,df3, family = binomial(link = "logit"))
cox <- revised_PseudoR2s(logits_rsquared)

#tapply(df3$NFC, df3$InCS, descriptives)
```

```{r prepplottinglogitall}

df3 <- df3[which(is.na(df3$NFC)==FALSE),]
levels(df3$InCS)
cbind.data.frame(df3$InCS,as.numeric(df3$InCS))


x <- df3$NFC
y <- as.numeric(df3$InCS)

m1 <- multinom(y ~ x)
# summary(m1)
newdata <- data.frame(x = seq(min(x), max(x), length.out = 100))
p1 <- predict(m1, newdata, type = "class")
p2 <- predict(m1, newdata, type = "probs")


logit_plot <- cbind.data.frame(newdata,p2)

logit_plot <- `colnames<-`(logit_plot, c("x","one_l","two_l","three_l"))
logit_plot <- melt(logit_plot, id="x")

```

\newpage


A multinomial logistic regression revealed a statistically significant association between Need for Cognition and response to the critical slide, $\chi$^2^(`r summary_InCS_model$lratio$parameter`, *N* = `r length(df3$gender)`) = `r round(summary_InCS_model$lratio$statistic, digits=2)`, *p* `r paste(p_report(summary_InCS_model$lratio$p.value))`, The observed
 power was `r round(pw$power,digits=2)`. Need for Cognition explained between `r round(cox$cox_and_snell*100, digits=2)`% (Cox and Snell R square) and `r round(cox$nagelkerke*100, digits=2)`% (Nadelkerke R squared) of the variance in responses to the critical slide. As Need for Cognition increased, participants were significantly more likely to provide reasons than to present as dumbfounded, Wald = `r round(wald1,digits=2)`, *p* `r paste(p_report(summary_InCS_model$CoefTable[15]))`, odds ratio = `r exp(InCSModel$coefficients)[3]`, 95% CI [`r a[3]`, `r a[7]`]. As Need for Cognition increased, participants were also significantly more likely to select there is nothing wrong than present as dumbfounded  Wald = `r round(wald2,digits=2)`, *p* `r paste(p_report(summary_InCS_model$CoefTable[16]))`, odds ratio = `r exp(InCSModel$coefficients)[4]`, 95% CI [`r a[4]`, `r a[8]`].  The relative probabilities of selecting each response depending on Need for Cognition are displayed in Figure\ \@ref(fig:ggplotlogitall).
 
\newpage

&nbsp;

```{r ggplotlogitall, fig.cap="Studies 1-5: Probability of selecting each response to the critical slide depending on Need for Cognition", include=TRUE}


ggplot(logit_plot,
       aes(x=x, y=value,
           #color=factor(variable,labels=c("dumb","reason","nothing"))
           linetype=factor(variable
                           #,labels=c("dumb","reason","nothing")
                           )
           )) +
  geom_line()+
  xlab("Need for Cognition") + ylab("Predicted Probability") +
  scale_y_continuous(limits = c(0, 1)) + 
  #scale_color_discrete(name="Response to \nCritical Slide", labels=c("Dumbfounded","Nothing Wrong","Reasons"))+
  scale_linetype_discrete(name="Response to \nCritical Slide"
                          , labels=c("Reasons","Dumbfounded","Nothing Wrong")
                          )+
  theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(size = .2),
        strip.background  = element_blank(),
        panel.grid = element_blank(),
        plot.title=element_text(#family="Times",
          size=12
        ),
        legend.text=element_text(#family="Times",
          size=8
        ),
        legend.title=element_text(#family="Times",
          size=10
        ),
        axis.text=element_text(#family="Times",
          colour = "black",
          size=8
        ),
        axis.ticks.x = element_blank(),
        axis.title=element_text(#family="Times",
          size=12
        ),
        strip.text=element_text(#family = "Times",
          size = 12
        ),
        #strip.background = element_rect(fill = "white"),
        legend.position="right")


```

\newpage


